

============================== 2025-05-21 13:48:34.150660 | 45f2e452-8ea0-4bed-b281-abfe0cc0e74a ==============================
[0m13:48:34.150696 [info ] [MainThread]: Running with dbt=1.3.0
[0m13:48:34.152848 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/usr/app/dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m13:48:34.156721 [debug] [MainThread]: Tracking: tracking
[0m13:48:34.172030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4c2357850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4c2357730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4c2357790>]}
[0m13:48:34.207504 [info ] [MainThread]: Partial parse save file not found. Starting full parse.
[0m13:48:34.209099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '45f2e452-8ea0-4bed-b281-abfe0cc0e74a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4c2349130>]}
[0m13:48:34.461744 [debug] [MainThread]: Parsing macros/timestamps.sql
[0m13:48:34.472199 [debug] [MainThread]: Parsing macros/catalog.sql
[0m13:48:34.477122 [debug] [MainThread]: Parsing macros/adapters.sql
[0m13:48:34.519973 [debug] [MainThread]: Parsing macros/relations.sql
[0m13:48:34.524581 [debug] [MainThread]: Parsing macros/utils/last_day.sql
[0m13:48:34.527870 [debug] [MainThread]: Parsing macros/utils/any_value.sql
[0m13:48:34.530737 [debug] [MainThread]: Parsing macros/utils/dateadd.sql
[0m13:48:34.533587 [debug] [MainThread]: Parsing macros/utils/listagg.sql
[0m13:48:34.537324 [debug] [MainThread]: Parsing macros/utils/datediff.sql
[0m13:48:34.554813 [debug] [MainThread]: Parsing macros/utils/split_part.sql
[0m13:48:34.559077 [debug] [MainThread]: Parsing macros/materializations/snapshot_merge.sql
[0m13:48:34.565359 [debug] [MainThread]: Parsing macros/materializations/incremental_strategies.sql
[0m13:48:34.568425 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_alias.sql
[0m13:48:34.572489 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_database.sql
[0m13:48:34.577035 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_schema.sql
[0m13:48:34.585542 [debug] [MainThread]: Parsing macros/utils/hash.sql
[0m13:48:34.589956 [debug] [MainThread]: Parsing macros/utils/concat.sql
[0m13:48:34.595538 [debug] [MainThread]: Parsing macros/utils/last_day.sql
[0m13:48:34.606054 [debug] [MainThread]: Parsing macros/utils/any_value.sql
[0m13:48:34.609182 [debug] [MainThread]: Parsing macros/utils/cast_bool_to_text.sql
[0m13:48:34.613908 [debug] [MainThread]: Parsing macros/utils/data_types.sql
[0m13:48:34.640357 [debug] [MainThread]: Parsing macros/utils/dateadd.sql
[0m13:48:34.676790 [debug] [MainThread]: Parsing macros/utils/right.sql
[0m13:48:34.691350 [debug] [MainThread]: Parsing macros/utils/literal.sql
[0m13:48:34.696320 [debug] [MainThread]: Parsing macros/utils/except.sql
[0m13:48:34.699772 [debug] [MainThread]: Parsing macros/utils/bool_or.sql
[0m13:48:34.725781 [debug] [MainThread]: Parsing macros/utils/listagg.sql
[0m13:48:34.733034 [debug] [MainThread]: Parsing macros/utils/intersect.sql
[0m13:48:34.736596 [debug] [MainThread]: Parsing macros/utils/date_trunc.sql
[0m13:48:34.743573 [debug] [MainThread]: Parsing macros/utils/datediff.sql
[0m13:48:34.750269 [debug] [MainThread]: Parsing macros/utils/array_append.sql
[0m13:48:34.755014 [debug] [MainThread]: Parsing macros/utils/escape_single_quotes.sql
[0m13:48:34.758268 [debug] [MainThread]: Parsing macros/utils/safe_cast.sql
[0m13:48:34.763827 [debug] [MainThread]: Parsing macros/utils/array_concat.sql
[0m13:48:34.767442 [debug] [MainThread]: Parsing macros/utils/replace.sql
[0m13:48:34.771893 [debug] [MainThread]: Parsing macros/utils/array_construct.sql
[0m13:48:34.775354 [debug] [MainThread]: Parsing macros/utils/split_part.sql
[0m13:48:34.780133 [debug] [MainThread]: Parsing macros/utils/position.sql
[0m13:48:34.784236 [debug] [MainThread]: Parsing macros/utils/length.sql
[0m13:48:34.787431 [debug] [MainThread]: Parsing macros/etc/datetime.sql
[0m13:48:34.805869 [debug] [MainThread]: Parsing macros/etc/statement.sql
[0m13:48:34.816397 [debug] [MainThread]: Parsing macros/generic_test_sql/relationships.sql
[0m13:48:34.819067 [debug] [MainThread]: Parsing macros/generic_test_sql/accepted_values.sql
[0m13:48:34.823817 [debug] [MainThread]: Parsing macros/generic_test_sql/unique.sql
[0m13:48:34.826179 [debug] [MainThread]: Parsing macros/generic_test_sql/not_null.sql
[0m13:48:34.828758 [debug] [MainThread]: Parsing macros/materializations/configs.sql
[0m13:48:34.835592 [debug] [MainThread]: Parsing macros/materializations/hooks.sql
[0m13:48:34.844266 [debug] [MainThread]: Parsing macros/materializations/seeds/seed.sql
[0m13:48:34.861782 [debug] [MainThread]: Parsing macros/materializations/seeds/helpers.sql
[0m13:48:34.898021 [debug] [MainThread]: Parsing macros/materializations/tests/test.sql
[0m13:48:34.910234 [debug] [MainThread]: Parsing macros/materializations/tests/where_subquery.sql
[0m13:48:34.915301 [debug] [MainThread]: Parsing macros/materializations/tests/helpers.sql
[0m13:48:34.925122 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot_merge.sql
[0m13:48:34.929361 [debug] [MainThread]: Parsing macros/materializations/snapshots/strategies.sql
[0m13:48:34.968545 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot.sql
[0m13:48:34.998873 [debug] [MainThread]: Parsing macros/materializations/snapshots/helpers.sql
[0m13:48:35.033395 [debug] [MainThread]: Parsing macros/materializations/models/table/create_table_as.sql
[0m13:48:35.040637 [debug] [MainThread]: Parsing macros/materializations/models/table/table.sql
[0m13:48:35.053376 [debug] [MainThread]: Parsing macros/materializations/models/view/create_or_replace_view.sql
[0m13:48:35.061473 [debug] [MainThread]: Parsing macros/materializations/models/view/view.sql
[0m13:48:35.075289 [debug] [MainThread]: Parsing macros/materializations/models/view/create_view_as.sql
[0m13:48:35.080297 [debug] [MainThread]: Parsing macros/materializations/models/view/helpers.sql
[0m13:48:35.084752 [debug] [MainThread]: Parsing macros/materializations/models/incremental/column_helpers.sql
[0m13:48:35.099779 [debug] [MainThread]: Parsing macros/materializations/models/incremental/merge.sql
[0m13:48:35.144003 [debug] [MainThread]: Parsing macros/materializations/models/incremental/strategies.sql
[0m13:48:35.179136 [debug] [MainThread]: Parsing macros/materializations/models/incremental/on_schema_change.sql
[0m13:48:35.238592 [debug] [MainThread]: Parsing macros/materializations/models/incremental/incremental.sql
[0m13:48:35.269145 [debug] [MainThread]: Parsing macros/materializations/models/incremental/is_incremental.sql
[0m13:48:35.274272 [debug] [MainThread]: Parsing macros/python_model/python.sql
[0m13:48:35.288955 [debug] [MainThread]: Parsing macros/adapters/indexes.sql
[0m13:48:35.296187 [debug] [MainThread]: Parsing macros/adapters/apply_grants.sql
[0m13:48:35.322367 [debug] [MainThread]: Parsing macros/adapters/freshness.sql
[0m13:48:35.327199 [debug] [MainThread]: Parsing macros/adapters/columns.sql
[0m13:48:35.410007 [debug] [MainThread]: Parsing macros/adapters/metadata.sql
[0m13:48:35.424301 [debug] [MainThread]: Parsing macros/adapters/timestamps.sql
[0m13:48:35.431836 [debug] [MainThread]: Parsing macros/adapters/schema.sql
[0m13:48:35.437284 [debug] [MainThread]: Parsing macros/adapters/persist_docs.sql
[0m13:48:35.446311 [debug] [MainThread]: Parsing macros/adapters/relation.sql
[0m13:48:35.483167 [debug] [MainThread]: Parsing tests/generic/builtin.sql
[0m13:48:36.107824 [debug] [MainThread]: 1699: static parser successfully parsed intermediate/trip_enriched.sql
[0m13:48:36.133069 [debug] [MainThread]: 1699: static parser successfully parsed marts/high_value_customers.sql
[0m13:48:36.140824 [debug] [MainThread]: 1699: static parser successfully parsed marts/trip_summary_per_hour.sql
[0m13:48:36.148887 [debug] [MainThread]: 1699: static parser successfully parsed staging/source_dim_weather.sql
[0m13:48:36.157258 [debug] [MainThread]: 1699: static parser successfully parsed staging/source_fact_taxi_trips.sql
[0m13:48:36.334749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '45f2e452-8ea0-4bed-b281-abfe0cc0e74a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4c1ef80d0>]}
[0m13:48:36.365358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '45f2e452-8ea0-4bed-b281-abfe0cc0e74a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4c2349ee0>]}
[0m13:48:36.367319 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 289 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m13:48:36.369374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45f2e452-8ea0-4bed-b281-abfe0cc0e74a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4c1f13d30>]}
[0m13:48:36.373902 [info ] [MainThread]: 
[0m13:48:36.376499 [debug] [MainThread]: Acquiring new postgres connection "master"
[0m13:48:36.382445 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db"
[0m13:48:36.418351 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db"
[0m13:48:36.419998 [debug] [ThreadPool]: On list_nyc_taxi_db: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db"} */

    select distinct nspname from pg_namespace
  
[0m13:48:36.421836 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:48:36.454560 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.03 seconds
[0m13:48:36.457353 [debug] [ThreadPool]: On list_nyc_taxi_db: Close
[0m13:48:36.460904 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db_public"
[0m13:48:36.472015 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m13:48:36.473401 [debug] [ThreadPool]: On list_nyc_taxi_db_public: BEGIN
[0m13:48:36.474531 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:48:36.484955 [debug] [ThreadPool]: SQL status: BEGIN in 0.01 seconds
[0m13:48:36.486499 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m13:48:36.487633 [debug] [ThreadPool]: On list_nyc_taxi_db_public: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db_public"} */
select
      'nyc_taxi_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'nyc_taxi_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
[0m13:48:36.505840 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.02 seconds
[0m13:48:36.509009 [debug] [ThreadPool]: On list_nyc_taxi_db_public: ROLLBACK
[0m13:48:36.510690 [debug] [ThreadPool]: On list_nyc_taxi_db_public: Close
[0m13:48:36.520527 [debug] [MainThread]: Using postgres connection "master"
[0m13:48:36.522099 [debug] [MainThread]: On master: BEGIN
[0m13:48:36.524214 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:48:36.537198 [debug] [MainThread]: SQL status: BEGIN in 0.01 seconds
[0m13:48:36.539134 [debug] [MainThread]: Using postgres connection "master"
[0m13:48:36.541512 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:48:36.578316 [debug] [MainThread]: SQL status: SELECT 0 in 0.03 seconds
[0m13:48:36.582428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45f2e452-8ea0-4bed-b281-abfe0cc0e74a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4c1eded60>]}
[0m13:48:36.586326 [debug] [MainThread]: On master: ROLLBACK
[0m13:48:36.588731 [debug] [MainThread]: Using postgres connection "master"
[0m13:48:36.590599 [debug] [MainThread]: On master: BEGIN
[0m13:48:36.593855 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:48:36.595519 [debug] [MainThread]: On master: COMMIT
[0m13:48:36.596987 [debug] [MainThread]: Using postgres connection "master"
[0m13:48:36.598437 [debug] [MainThread]: On master: COMMIT
[0m13:48:36.601460 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:48:36.603425 [debug] [MainThread]: On master: Close
[0m13:48:36.605919 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:48:36.607790 [info ] [MainThread]: 
[0m13:48:36.663029 [debug] [Thread-1  ]: Began running node model.nyc_taxi.source_dim_weather
[0m13:48:36.663430 [debug] [Thread-2  ]: Began running node model.nyc_taxi.source_fact_taxi_trips
[0m13:48:36.664832 [info ] [Thread-1  ]: 1 of 5 START sql view model public.source_dim_weather .......................... [RUN]
[0m13:48:36.666057 [info ] [Thread-2  ]: 2 of 5 START sql view model public.source_fact_taxi_trips ...................... [RUN]
[0m13:48:36.668134 [debug] [Thread-1  ]: Acquiring new postgres connection "model.nyc_taxi.source_dim_weather"
[0m13:48:36.670692 [debug] [Thread-2  ]: Acquiring new postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m13:48:36.672486 [debug] [Thread-1  ]: Began compiling node model.nyc_taxi.source_dim_weather
[0m13:48:36.674703 [debug] [Thread-2  ]: Began compiling node model.nyc_taxi.source_fact_taxi_trips
[0m13:48:36.676087 [debug] [Thread-1  ]: Compiling model.nyc_taxi.source_dim_weather
[0m13:48:36.677262 [debug] [Thread-2  ]: Compiling model.nyc_taxi.source_fact_taxi_trips
[0m13:48:36.684983 [debug] [Thread-1  ]: Writing injected SQL for node "model.nyc_taxi.source_dim_weather"
[0m13:48:36.691068 [debug] [Thread-2  ]: Writing injected SQL for node "model.nyc_taxi.source_fact_taxi_trips"
[0m13:48:36.709504 [debug] [Thread-1  ]: finished collecting timing info
[0m13:48:36.712096 [debug] [Thread-1  ]: Began executing node model.nyc_taxi.source_dim_weather
[0m13:48:36.713233 [debug] [Thread-2  ]: finished collecting timing info
[0m13:48:36.735993 [debug] [Thread-2  ]: Began executing node model.nyc_taxi.source_fact_taxi_trips
[0m13:48:36.809271 [debug] [Thread-2  ]: Writing runtime sql for node "model.nyc_taxi.source_fact_taxi_trips"
[0m13:48:36.812439 [debug] [Thread-1  ]: Writing runtime sql for node "model.nyc_taxi.source_dim_weather"
[0m13:48:36.834257 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m13:48:36.835684 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: BEGIN
[0m13:48:36.837248 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m13:48:36.839355 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m13:48:36.841036 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: BEGIN
[0m13:48:36.845533 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:48:36.849857 [debug] [Thread-2  ]: SQL status: BEGIN in 0.01 seconds
[0m13:48:36.851990 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m13:48:36.853608 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */

  create view "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" as (
    

SELECT
    pickup_datetime,
    dropoff_datetime,
    trip_duration_minutes,
    distance_km,
    distance_bucket,
    fare_amount,
    tip_amount,
    tip_percentage,
    payment_type,
    pickup_hour,
    pickup_day_of_week,
    passenger_count,
    pickup_location_id,
    dropoff_location_id
FROM
    "nyc_taxi_db"."public"."fact_taxi_trips"
  );
[0m13:48:36.863271 [debug] [Thread-1  ]: SQL status: BEGIN in 0.02 seconds
[0m13:48:36.865266 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m13:48:36.866842 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */

  create view "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" as (
    

SELECT
    timestamp,
    temperature,
    humidity,
    wind_speed,
    weather_condition,
    weather_description,
    weather_category,
    hour_of_day,
    day_of_week
FROM
    "nyc_taxi_db"."public"."dim_weather"
  );
[0m13:48:36.875831 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.02 seconds
[0m13:48:36.876385 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.01 seconds
[0m13:48:36.891601 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m13:48:36.898720 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m13:48:36.899578 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
alter table "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" rename to "source_fact_taxi_trips"
[0m13:48:36.900797 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
alter table "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" rename to "source_dim_weather"
[0m13:48:36.905330 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:48:36.905602 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:48:36.942844 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m13:48:36.946085 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m13:48:36.946979 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m13:48:36.948279 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m13:48:36.949481 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m13:48:36.950847 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m13:48:36.961712 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m13:48:36.963059 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m13:48:36.974454 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m13:48:36.978876 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m13:48:36.980194 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
drop view if exists "nyc_taxi_db"."public"."source_dim_weather__dbt_backup" cascade
[0m13:48:36.981889 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
drop view if exists "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_backup" cascade
[0m13:48:36.984617 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m13:48:36.984903 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.0 seconds
[0m13:48:36.987605 [debug] [Thread-1  ]: finished collecting timing info
[0m13:48:36.989929 [debug] [Thread-2  ]: finished collecting timing info
[0m13:48:36.991195 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: Close
[0m13:48:36.992401 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: Close
[0m13:48:36.994595 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45f2e452-8ea0-4bed-b281-abfe0cc0e74a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4c1ebedf0>]}
[0m13:48:36.996381 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45f2e452-8ea0-4bed-b281-abfe0cc0e74a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4c1eb3f70>]}
[0m13:48:36.997845 [info ] [Thread-1  ]: 1 of 5 OK created sql view model public.source_dim_weather ..................... [[32mCREATE VIEW[0m in 0.33s]
[0m13:48:36.999611 [info ] [Thread-2  ]: 2 of 5 OK created sql view model public.source_fact_taxi_trips ................. [[32mCREATE VIEW[0m in 0.33s]
[0m13:48:37.001714 [debug] [Thread-1  ]: Finished running node model.nyc_taxi.source_dim_weather
[0m13:48:37.003831 [debug] [Thread-2  ]: Finished running node model.nyc_taxi.source_fact_taxi_trips
[0m13:48:37.007579 [debug] [Thread-4  ]: Began running node model.nyc_taxi.trip_enriched
[0m13:48:37.008928 [info ] [Thread-4  ]: 3 of 5 START sql table model public.trip_enriched .............................. [RUN]
[0m13:48:37.012301 [debug] [Thread-4  ]: Acquiring new postgres connection "model.nyc_taxi.trip_enriched"
[0m13:48:37.015341 [debug] [Thread-4  ]: Began compiling node model.nyc_taxi.trip_enriched
[0m13:48:37.016693 [debug] [Thread-4  ]: Compiling model.nyc_taxi.trip_enriched
[0m13:48:37.025550 [debug] [Thread-4  ]: Writing injected SQL for node "model.nyc_taxi.trip_enriched"
[0m13:48:37.044461 [debug] [Thread-4  ]: finished collecting timing info
[0m13:48:37.046069 [debug] [Thread-4  ]: Began executing node model.nyc_taxi.trip_enriched
[0m13:48:37.086634 [debug] [Thread-4  ]: Writing runtime sql for node "model.nyc_taxi.trip_enriched"
[0m13:48:37.105511 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m13:48:37.106952 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: BEGIN
[0m13:48:37.108286 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m13:48:37.118157 [debug] [Thread-4  ]: SQL status: BEGIN in 0.01 seconds
[0m13:48:37.119938 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m13:48:37.121916 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */

  
    

  create  table "nyc_taxi_db"."public"."trip_enriched__dbt_tmp"
  as (
    

WITH taxi_trips AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_fact_taxi_trips"
),

weather AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_dim_weather"
)

SELECT
    t.pickup_datetime,
    t.dropoff_datetime,
    t.trip_duration_minutes,
    t.distance_km,
    t.distance_bucket,
    t.fare_amount,
    t.tip_amount,
    t.tip_percentage,
    t.payment_type,
    t.pickup_hour,
    t.pickup_day_of_week,
    t.passenger_count,
    t.pickup_location_id,
    t.dropoff_location_id,
    w.temperature,
    w.humidity,
    w.wind_speed,
    w.weather_condition,
    w.weather_category
FROM
    taxi_trips t
LEFT JOIN
    weather w
    -- Join on the closest weather observation by hour
    ON t.pickup_hour = w.hour_of_day
    AND t.pickup_day_of_week = w.day_of_week
  );
  
[0m13:52:26.043550 [debug] [Thread-4  ]: SQL status: SELECT 41970718 in 228.88 seconds
[0m13:52:26.457174 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m13:52:26.460295 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */
alter table "nyc_taxi_db"."public"."trip_enriched__dbt_tmp" rename to "trip_enriched"
[0m13:52:26.477909 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.02 seconds
[0m13:52:26.550917 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: COMMIT
[0m13:52:26.553283 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m13:52:26.554730 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: COMMIT
[0m13:52:26.560348 [debug] [Thread-4  ]: SQL status: COMMIT in 0.0 seconds
[0m13:52:26.567678 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m13:52:26.569115 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */
drop table if exists "nyc_taxi_db"."public"."trip_enriched__dbt_backup" cascade
[0m13:52:26.574046 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.0 seconds
[0m13:52:26.597208 [debug] [Thread-4  ]: finished collecting timing info
[0m13:52:26.599742 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: Close
[0m13:52:26.627641 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45f2e452-8ea0-4bed-b281-abfe0cc0e74a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4c1b88370>]}
[0m13:52:26.643605 [info ] [Thread-4  ]: 3 of 5 OK created sql table model public.trip_enriched ......................... [[32mSELECT 41970718[0m in 229.60s]
[0m13:52:26.709387 [debug] [Thread-4  ]: Finished running node model.nyc_taxi.trip_enriched
[0m13:52:26.784351 [debug] [Thread-1  ]: Began running node model.nyc_taxi.high_value_customers
[0m13:52:26.788192 [debug] [Thread-2  ]: Began running node model.nyc_taxi.trip_summary_per_hour
[0m13:52:26.795061 [info ] [Thread-1  ]: 4 of 5 START sql table model public.high_value_customers ....................... [RUN]
[0m13:52:26.816769 [info ] [Thread-2  ]: 5 of 5 START sql table model public.trip_summary_per_hour ...................... [RUN]
[0m13:52:26.836926 [debug] [Thread-1  ]: Acquiring new postgres connection "model.nyc_taxi.high_value_customers"
[0m13:52:26.849657 [debug] [Thread-2  ]: Acquiring new postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m13:52:26.851644 [debug] [Thread-1  ]: Began compiling node model.nyc_taxi.high_value_customers
[0m13:52:26.853334 [debug] [Thread-2  ]: Began compiling node model.nyc_taxi.trip_summary_per_hour
[0m13:52:26.858442 [debug] [Thread-1  ]: Compiling model.nyc_taxi.high_value_customers
[0m13:52:26.860415 [debug] [Thread-2  ]: Compiling model.nyc_taxi.trip_summary_per_hour
[0m13:52:26.914469 [debug] [Thread-1  ]: Writing injected SQL for node "model.nyc_taxi.high_value_customers"
[0m13:52:26.915658 [debug] [Thread-2  ]: Writing injected SQL for node "model.nyc_taxi.trip_summary_per_hour"
[0m13:52:26.956257 [debug] [Thread-2  ]: finished collecting timing info
[0m13:52:26.959320 [debug] [Thread-1  ]: finished collecting timing info
[0m13:52:26.960071 [debug] [Thread-2  ]: Began executing node model.nyc_taxi.trip_summary_per_hour
[0m13:52:26.961829 [debug] [Thread-1  ]: Began executing node model.nyc_taxi.high_value_customers
[0m13:52:27.000517 [debug] [Thread-2  ]: Writing runtime sql for node "model.nyc_taxi.trip_summary_per_hour"
[0m13:52:27.015271 [debug] [Thread-1  ]: Writing runtime sql for node "model.nyc_taxi.high_value_customers"
[0m13:52:27.028841 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m13:52:27.032223 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: BEGIN
[0m13:52:27.034272 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m13:52:27.035646 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m13:52:27.037268 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: BEGIN
[0m13:52:27.043580 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:52:27.071538 [debug] [Thread-1  ]: SQL status: BEGIN in 0.03 seconds
[0m13:52:27.071917 [debug] [Thread-2  ]: SQL status: BEGIN in 0.04 seconds
[0m13:52:27.073189 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m13:52:27.074604 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m13:52:27.075827 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.high_value_customers"} */

  
    

  create  table "nyc_taxi_db"."public"."high_value_customers__dbt_tmp"
  as (
    

WITH trip_data AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."trip_enriched"
),

customer_stats AS (
    SELECT
        -- Using passenger_count as a proxy for customer identification
        -- In a real scenario, you might have a proper customer ID
        passenger_count,
        pickup_location_id,
        COUNT(*) AS num_trips,
        SUM(fare_amount + tip_amount) AS total_spent,
        AVG(tip_percentage) AS avg_tip_percentage
    FROM
        trip_data
    WHERE
        passenger_count > 0
    GROUP BY
        passenger_count,
        pickup_location_id
)

SELECT
    passenger_count,
    pickup_location_id,
    num_trips,
    total_spent,
    avg_tip_percentage
FROM
    customer_stats
WHERE
    num_trips > 10
    AND total_spent > 300
    AND avg_tip_percentage > 15
  );
  
[0m13:52:27.076959 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */

  
    

  create  table "nyc_taxi_db"."public"."trip_summary_per_hour__dbt_tmp"
  as (
    

WITH trip_data AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."trip_enriched"
)

SELECT
    pickup_hour,
    weather_category,
    COUNT(*) AS num_trips,
    AVG(trip_duration_minutes) AS avg_trip_duration,
    AVG(tip_percentage) AS avg_tip_percentage,
    AVG(fare_amount) AS avg_fare_amount,
    AVG(distance_km) AS avg_distance
FROM
    trip_data
GROUP BY
    pickup_hour,
    weather_category
  );
  
[0m13:53:44.961483 [debug] [Thread-1  ]: SQL status: SELECT 524 in 77.88 seconds
[0m13:53:44.976346 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m13:53:44.977605 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.high_value_customers"} */
alter table "nyc_taxi_db"."public"."high_value_customers__dbt_tmp" rename to "high_value_customers"
[0m13:53:44.980303 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:53:44.981473 [debug] [Thread-2  ]: SQL status: SELECT 30 in 77.9 seconds
[0m13:53:44.985768 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: COMMIT
[0m13:53:44.992988 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m13:53:44.994452 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m13:53:44.995814 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */
alter table "nyc_taxi_db"."public"."trip_summary_per_hour__dbt_tmp" rename to "trip_summary_per_hour"
[0m13:53:44.997068 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: COMMIT
[0m13:53:44.998976 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:53:45.004762 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: COMMIT
[0m13:53:45.005107 [debug] [Thread-1  ]: SQL status: COMMIT in 0.01 seconds
[0m13:53:45.006378 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m13:53:45.013534 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m13:53:45.014765 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: COMMIT
[0m13:53:45.015854 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.high_value_customers"} */
drop table if exists "nyc_taxi_db"."public"."high_value_customers__dbt_backup" cascade
[0m13:53:45.018425 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.0 seconds
[0m13:53:45.019198 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m13:53:45.022409 [debug] [Thread-1  ]: finished collecting timing info
[0m13:53:45.026842 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m13:53:45.028365 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: Close
[0m13:53:45.029865 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */
drop table if exists "nyc_taxi_db"."public"."trip_summary_per_hour__dbt_backup" cascade
[0m13:53:45.032754 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45f2e452-8ea0-4bed-b281-abfe0cc0e74a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4c1eb3cd0>]}
[0m13:53:45.034352 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.0 seconds
[0m13:53:45.036810 [info ] [Thread-1  ]: 4 of 5 OK created sql table model public.high_value_customers .................. [[32mSELECT 524[0m in 78.21s]
[0m13:53:45.043611 [debug] [Thread-2  ]: finished collecting timing info
[0m13:53:45.045786 [debug] [Thread-1  ]: Finished running node model.nyc_taxi.high_value_customers
[0m13:53:45.046701 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: Close
[0m13:53:45.051996 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45f2e452-8ea0-4bed-b281-abfe0cc0e74a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4c1e83ca0>]}
[0m13:53:45.054402 [info ] [Thread-2  ]: 5 of 5 OK created sql table model public.trip_summary_per_hour ................. [[32mSELECT 30[0m in 78.21s]
[0m13:53:45.058094 [debug] [Thread-2  ]: Finished running node model.nyc_taxi.trip_summary_per_hour
[0m13:53:45.105730 [debug] [MainThread]: Acquiring new postgres connection "master"
[0m13:53:45.109074 [debug] [MainThread]: Using postgres connection "master"
[0m13:53:45.110303 [debug] [MainThread]: On master: BEGIN
[0m13:53:45.111804 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:53:45.176512 [debug] [MainThread]: SQL status: BEGIN in 0.06 seconds
[0m13:53:45.179682 [debug] [MainThread]: On master: COMMIT
[0m13:53:45.180978 [debug] [MainThread]: Using postgres connection "master"
[0m13:53:45.182207 [debug] [MainThread]: On master: COMMIT
[0m13:53:45.183940 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:53:45.185436 [debug] [MainThread]: On master: Close
[0m13:53:45.197786 [info ] [MainThread]: 
[0m13:53:45.202407 [info ] [MainThread]: Finished running 2 view models, 3 table models in 0 hours 5 minutes and 8.81 seconds (308.81s).
[0m13:53:45.205417 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:53:45.207035 [debug] [MainThread]: Connection 'model.nyc_taxi.high_value_customers' was properly closed.
[0m13:53:45.208189 [debug] [MainThread]: Connection 'model.nyc_taxi.trip_summary_per_hour' was properly closed.
[0m13:53:45.209271 [debug] [MainThread]: Connection 'model.nyc_taxi.trip_enriched' was properly closed.
[0m13:53:45.342416 [info ] [MainThread]: 
[0m13:53:45.345843 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:53:45.348424 [info ] [MainThread]: 
[0m13:53:45.353397 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m13:53:45.375004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4c1b9e220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4c1b5cee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4c1b5cf10>]}
[0m13:53:45.377243 [debug] [MainThread]: Flushing usage events


============================== 2025-05-21 17:50:45.702185 | 845a505e-1869-44b7-a551-e5839a861cd8 ==============================
[0m17:50:45.702275 [info ] [MainThread]: Running with dbt=1.3.0
[0m17:50:45.704254 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/usr/app/dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m17:50:45.705470 [debug] [MainThread]: Tracking: tracking
[0m17:50:45.718539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f75005ce880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f75005ce760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f75005ce7c0>]}
[0m17:50:46.016114 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:50:46.017135 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:50:46.031527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '845a505e-1869-44b7-a551-e5839a861cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f75001a30d0>]}
[0m17:50:46.054201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '845a505e-1869-44b7-a551-e5839a861cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7500551430>]}
[0m17:50:46.055647 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 289 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m17:50:46.056844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '845a505e-1869-44b7-a551-e5839a861cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7500551460>]}
[0m17:50:46.060476 [info ] [MainThread]: 
[0m17:50:46.063228 [debug] [MainThread]: Acquiring new postgres connection "master"
[0m17:50:46.068870 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db"
[0m17:50:46.131167 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db"
[0m17:50:46.132646 [debug] [ThreadPool]: On list_nyc_taxi_db: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db"} */

    select distinct nspname from pg_namespace
  
[0m17:50:46.133730 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:50:46.174973 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.04 seconds
[0m17:50:46.177805 [debug] [ThreadPool]: On list_nyc_taxi_db: Close
[0m17:50:46.181611 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db_public"
[0m17:50:46.194021 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m17:50:46.195313 [debug] [ThreadPool]: On list_nyc_taxi_db_public: BEGIN
[0m17:50:46.196401 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:50:46.206407 [debug] [ThreadPool]: SQL status: BEGIN in 0.01 seconds
[0m17:50:46.207682 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m17:50:46.208948 [debug] [ThreadPool]: On list_nyc_taxi_db_public: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db_public"} */
select
      'nyc_taxi_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'nyc_taxi_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
[0m17:50:46.226955 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.02 seconds
[0m17:50:46.230380 [debug] [ThreadPool]: On list_nyc_taxi_db_public: ROLLBACK
[0m17:50:46.232109 [debug] [ThreadPool]: On list_nyc_taxi_db_public: Close
[0m17:50:46.241494 [debug] [MainThread]: Using postgres connection "master"
[0m17:50:46.242681 [debug] [MainThread]: On master: BEGIN
[0m17:50:46.243693 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:50:46.253260 [debug] [MainThread]: SQL status: BEGIN in 0.01 seconds
[0m17:50:46.254588 [debug] [MainThread]: Using postgres connection "master"
[0m17:50:46.255695 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:50:46.281995 [debug] [MainThread]: SQL status: SELECT 2 in 0.03 seconds
[0m17:50:46.285104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '845a505e-1869-44b7-a551-e5839a861cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f75001e8df0>]}
[0m17:50:46.286301 [debug] [MainThread]: On master: ROLLBACK
[0m17:50:46.287532 [debug] [MainThread]: Using postgres connection "master"
[0m17:50:46.288619 [debug] [MainThread]: On master: BEGIN
[0m17:50:46.289981 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m17:50:46.290917 [debug] [MainThread]: On master: COMMIT
[0m17:50:46.291961 [debug] [MainThread]: Using postgres connection "master"
[0m17:50:46.292966 [debug] [MainThread]: On master: COMMIT
[0m17:50:46.294068 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m17:50:46.295043 [debug] [MainThread]: On master: Close
[0m17:50:46.296670 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:50:46.298004 [info ] [MainThread]: 
[0m17:50:46.326552 [debug] [Thread-1  ]: Began running node model.nyc_taxi.source_dim_weather
[0m17:50:46.326852 [debug] [Thread-2  ]: Began running node model.nyc_taxi.source_fact_taxi_trips
[0m17:50:46.327817 [info ] [Thread-1  ]: 1 of 5 START sql view model public.source_dim_weather .......................... [RUN]
[0m17:50:46.329001 [info ] [Thread-2  ]: 2 of 5 START sql view model public.source_fact_taxi_trips ...................... [RUN]
[0m17:50:46.331124 [debug] [Thread-1  ]: Acquiring new postgres connection "model.nyc_taxi.source_dim_weather"
[0m17:50:46.334342 [debug] [Thread-2  ]: Acquiring new postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m17:50:46.335112 [debug] [Thread-1  ]: Began compiling node model.nyc_taxi.source_dim_weather
[0m17:50:46.336215 [debug] [Thread-2  ]: Began compiling node model.nyc_taxi.source_fact_taxi_trips
[0m17:50:46.337328 [debug] [Thread-1  ]: Compiling model.nyc_taxi.source_dim_weather
[0m17:50:46.338362 [debug] [Thread-2  ]: Compiling model.nyc_taxi.source_fact_taxi_trips
[0m17:50:46.345652 [debug] [Thread-1  ]: Writing injected SQL for node "model.nyc_taxi.source_dim_weather"
[0m17:50:46.351488 [debug] [Thread-2  ]: Writing injected SQL for node "model.nyc_taxi.source_fact_taxi_trips"
[0m17:50:46.359790 [debug] [Thread-1  ]: finished collecting timing info
[0m17:50:46.361810 [debug] [Thread-1  ]: Began executing node model.nyc_taxi.source_dim_weather
[0m17:50:46.363464 [debug] [Thread-2  ]: finished collecting timing info
[0m17:50:46.388704 [debug] [Thread-2  ]: Began executing node model.nyc_taxi.source_fact_taxi_trips
[0m17:50:46.462530 [debug] [Thread-2  ]: Writing runtime sql for node "model.nyc_taxi.source_fact_taxi_trips"
[0m17:50:46.465698 [debug] [Thread-1  ]: Writing runtime sql for node "model.nyc_taxi.source_dim_weather"
[0m17:50:46.475295 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m17:50:46.477324 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: BEGIN
[0m17:50:46.479008 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m17:50:46.479592 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:50:46.481688 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: BEGIN
[0m17:50:46.485260 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:50:46.493011 [debug] [Thread-1  ]: SQL status: BEGIN in 0.01 seconds
[0m17:50:46.494562 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m17:50:46.496279 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */

  create view "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" as (
    

SELECT
    timestamp,
    temperature,
    humidity,
    wind_speed,
    weather_condition,
    weather_description,
    weather_category,
    hour_of_day,
    day_of_week
FROM
    "nyc_taxi_db"."public"."dim_weather"
  );
[0m17:50:46.497752 [debug] [Thread-2  ]: SQL status: BEGIN in 0.01 seconds
[0m17:50:46.499305 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m17:50:46.500584 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */

  create view "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" as (
    

SELECT
    pickup_datetime,
    dropoff_datetime,
    trip_duration_minutes,
    distance_km,
    distance_bucket,
    fare_amount,
    tip_amount,
    tip_percentage,
    payment_type,
    pickup_hour,
    pickup_day_of_week,
    passenger_count,
    pickup_location_id,
    dropoff_location_id
FROM
    "nyc_taxi_db"."public"."fact_taxi_trips"
  );
[0m17:50:46.523773 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.03 seconds
[0m17:50:46.524079 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.02 seconds
[0m17:50:46.539200 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m17:50:46.544133 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m17:50:46.545637 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
alter table "nyc_taxi_db"."public"."source_dim_weather" rename to "source_dim_weather__dbt_backup"
[0m17:50:46.546951 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
alter table "nyc_taxi_db"."public"."source_fact_taxi_trips" rename to "source_fact_taxi_trips__dbt_backup"
[0m17:50:46.552138 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:50:46.552452 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:50:46.557704 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m17:50:46.562782 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m17:50:46.564165 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
alter table "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" rename to "source_dim_weather"
[0m17:50:46.565357 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
alter table "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" rename to "source_fact_taxi_trips"
[0m17:50:46.567439 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:50:46.568605 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:50:46.613542 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m17:50:46.614721 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m17:50:46.615440 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m17:50:46.616477 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m17:50:46.617385 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m17:50:46.618280 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m17:50:46.622230 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m17:50:46.628453 [debug] [Thread-2  ]: SQL status: COMMIT in 0.01 seconds
[0m17:50:46.631630 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m17:50:46.635252 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m17:50:46.636356 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
drop view if exists "nyc_taxi_db"."public"."source_dim_weather__dbt_backup" cascade
[0m17:50:46.637329 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
drop view if exists "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_backup" cascade
[0m17:50:46.646753 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.01 seconds
[0m17:50:46.649830 [debug] [Thread-2  ]: finished collecting timing info
[0m17:50:46.650078 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.01 seconds
[0m17:50:46.651015 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: Close
[0m17:50:46.653753 [debug] [Thread-1  ]: finished collecting timing info
[0m17:50:46.655599 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '845a505e-1869-44b7-a551-e5839a861cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f750011c730>]}
[0m17:50:46.656339 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: Close
[0m17:50:46.657805 [info ] [Thread-2  ]: 2 of 5 OK created sql view model public.source_fact_taxi_trips ................. [[32mCREATE VIEW[0m in 0.32s]
[0m17:50:46.660008 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '845a505e-1869-44b7-a551-e5839a861cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f750015a0a0>]}
[0m17:50:46.661462 [debug] [Thread-2  ]: Finished running node model.nyc_taxi.source_fact_taxi_trips
[0m17:50:46.663008 [info ] [Thread-1  ]: 1 of 5 OK created sql view model public.source_dim_weather ..................... [[32mCREATE VIEW[0m in 0.33s]
[0m17:50:46.666311 [debug] [Thread-1  ]: Finished running node model.nyc_taxi.source_dim_weather
[0m17:50:46.668869 [debug] [Thread-4  ]: Began running node model.nyc_taxi.trip_enriched
[0m17:50:46.670104 [info ] [Thread-4  ]: 3 of 5 START sql table model public.trip_enriched .............................. [RUN]
[0m17:50:46.672087 [debug] [Thread-4  ]: Acquiring new postgres connection "model.nyc_taxi.trip_enriched"
[0m17:50:46.673712 [debug] [Thread-4  ]: Began compiling node model.nyc_taxi.trip_enriched
[0m17:50:46.674853 [debug] [Thread-4  ]: Compiling model.nyc_taxi.trip_enriched
[0m17:50:46.682968 [debug] [Thread-4  ]: Writing injected SQL for node "model.nyc_taxi.trip_enriched"
[0m17:50:46.693007 [debug] [Thread-4  ]: finished collecting timing info
[0m17:50:46.694214 [debug] [Thread-4  ]: Began executing node model.nyc_taxi.trip_enriched
[0m17:50:46.733204 [debug] [Thread-4  ]: Writing runtime sql for node "model.nyc_taxi.trip_enriched"
[0m17:50:46.743552 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m17:50:46.744862 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: BEGIN
[0m17:50:46.745913 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:50:46.753971 [debug] [Thread-4  ]: SQL status: BEGIN in 0.01 seconds
[0m17:50:46.755134 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m17:50:46.756272 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */

  
    

  create  table "nyc_taxi_db"."public"."trip_enriched__dbt_tmp"
  as (
    

WITH taxi_trips AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_fact_taxi_trips"
),

weather AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_dim_weather"
)

SELECT
    t.pickup_datetime,
    t.dropoff_datetime,
    t.trip_duration_minutes,
    t.distance_km,
    t.distance_bucket,
    t.fare_amount,
    t.tip_amount,
    t.tip_percentage,
    t.payment_type,
    t.pickup_hour,
    t.pickup_day_of_week,
    t.passenger_count,
    t.pickup_location_id,
    t.dropoff_location_id,
    w.temperature,
    w.humidity,
    w.wind_speed,
    w.weather_condition,
    w.weather_category
FROM
    taxi_trips t
LEFT JOIN
    weather w
    -- Join on the closest weather observation by hour
    ON t.pickup_hour = w.hour_of_day
    AND t.pickup_day_of_week = w.day_of_week
  );
  
[0m17:52:49.292895 [debug] [Thread-4  ]: SQL status: SELECT 41970718 in 122.54 seconds
[0m17:52:49.305097 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m17:52:49.306767 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */
alter table "nyc_taxi_db"."public"."trip_enriched" rename to "trip_enriched__dbt_backup"
[0m17:52:49.309483 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:52:49.315731 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m17:52:49.317757 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */
alter table "nyc_taxi_db"."public"."trip_enriched__dbt_tmp" rename to "trip_enriched"
[0m17:52:49.319650 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:52:49.334050 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: COMMIT
[0m17:52:49.335250 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m17:52:49.336252 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: COMMIT
[0m17:52:49.353166 [debug] [Thread-4  ]: SQL status: COMMIT in 0.02 seconds
[0m17:52:49.357694 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m17:52:49.358950 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */
drop table if exists "nyc_taxi_db"."public"."trip_enriched__dbt_backup" cascade
[0m17:52:49.402448 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.04 seconds
[0m17:52:49.406103 [debug] [Thread-4  ]: finished collecting timing info
[0m17:52:49.407616 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: Close
[0m17:52:49.410026 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '845a505e-1869-44b7-a551-e5839a861cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f750015a190>]}
[0m17:52:49.411818 [info ] [Thread-4  ]: 3 of 5 OK created sql table model public.trip_enriched ......................... [[32mSELECT 41970718[0m in 122.74s]
[0m17:52:49.415744 [debug] [Thread-4  ]: Finished running node model.nyc_taxi.trip_enriched
[0m17:52:49.422203 [debug] [Thread-2  ]: Began running node model.nyc_taxi.high_value_customers
[0m17:52:49.424627 [debug] [Thread-1  ]: Began running node model.nyc_taxi.trip_summary_per_hour
[0m17:52:49.428722 [info ] [Thread-2  ]: 4 of 5 START sql table model public.high_value_customers ....................... [RUN]
[0m17:52:49.430851 [info ] [Thread-1  ]: 5 of 5 START sql table model public.trip_summary_per_hour ...................... [RUN]
[0m17:52:49.433407 [debug] [Thread-2  ]: Acquiring new postgres connection "model.nyc_taxi.high_value_customers"
[0m17:52:49.436612 [debug] [Thread-1  ]: Acquiring new postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m17:52:49.438813 [debug] [Thread-2  ]: Began compiling node model.nyc_taxi.high_value_customers
[0m17:52:49.441376 [debug] [Thread-1  ]: Began compiling node model.nyc_taxi.trip_summary_per_hour
[0m17:52:49.443132 [debug] [Thread-2  ]: Compiling model.nyc_taxi.high_value_customers
[0m17:52:49.444464 [debug] [Thread-1  ]: Compiling model.nyc_taxi.trip_summary_per_hour
[0m17:52:49.454448 [debug] [Thread-2  ]: Writing injected SQL for node "model.nyc_taxi.high_value_customers"
[0m17:52:49.463933 [debug] [Thread-1  ]: Writing injected SQL for node "model.nyc_taxi.trip_summary_per_hour"
[0m17:52:49.472981 [debug] [Thread-1  ]: finished collecting timing info
[0m17:52:49.474412 [debug] [Thread-2  ]: finished collecting timing info
[0m17:52:49.474882 [debug] [Thread-1  ]: Began executing node model.nyc_taxi.trip_summary_per_hour
[0m17:52:49.476337 [debug] [Thread-2  ]: Began executing node model.nyc_taxi.high_value_customers
[0m17:52:49.495325 [debug] [Thread-1  ]: Writing runtime sql for node "model.nyc_taxi.trip_summary_per_hour"
[0m17:52:49.510327 [debug] [Thread-2  ]: Writing runtime sql for node "model.nyc_taxi.high_value_customers"
[0m17:52:49.518777 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m17:52:49.520502 [debug] [Thread-1  ]: On model.nyc_taxi.trip_summary_per_hour: BEGIN
[0m17:52:49.522027 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m17:52:49.522406 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:52:49.523624 [debug] [Thread-2  ]: On model.nyc_taxi.high_value_customers: BEGIN
[0m17:52:49.527473 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m17:52:49.545548 [debug] [Thread-1  ]: SQL status: BEGIN in 0.02 seconds
[0m17:52:49.546892 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m17:52:49.548098 [debug] [Thread-1  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */

  
    

  create  table "nyc_taxi_db"."public"."trip_summary_per_hour__dbt_tmp"
  as (
    

WITH trip_data AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."trip_enriched"
)

SELECT
    pickup_hour,
    weather_category,
    COUNT(*) AS num_trips,
    AVG(trip_duration_minutes) AS avg_trip_duration,
    AVG(tip_percentage) AS avg_tip_percentage,
    AVG(fare_amount) AS avg_fare_amount,
    AVG(distance_km) AS avg_distance
FROM
    trip_data
GROUP BY
    pickup_hour,
    weather_category
  );
  
[0m17:52:49.549413 [debug] [Thread-2  ]: SQL status: BEGIN in 0.02 seconds
[0m17:52:49.550705 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m17:52:49.551741 [debug] [Thread-2  ]: On model.nyc_taxi.high_value_customers: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.high_value_customers"} */

  
    

  create  table "nyc_taxi_db"."public"."high_value_customers__dbt_tmp"
  as (
    

WITH trip_data AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."trip_enriched"
),

customer_stats AS (
    SELECT
        -- Using passenger_count as a proxy for customer identification
        -- In a real scenario, you might have a proper customer ID
        passenger_count,
        pickup_location_id,
        COUNT(*) AS num_trips,
        SUM(fare_amount + tip_amount) AS total_spent,
        AVG(tip_percentage) AS avg_tip_percentage
    FROM
        trip_data
    WHERE
        passenger_count > 0
    GROUP BY
        passenger_count,
        pickup_location_id
)

SELECT
    passenger_count,
    pickup_location_id,
    num_trips,
    total_spent,
    avg_tip_percentage
FROM
    customer_stats
WHERE
    num_trips > 10
    AND total_spent > 300
    AND avg_tip_percentage > 15
  );
  
[0m17:53:49.506707 [debug] [Thread-1  ]: SQL status: SELECT 30 in 59.96 seconds
[0m17:53:49.507317 [debug] [Thread-2  ]: SQL status: SELECT 524 in 59.95 seconds
[0m17:53:49.516937 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m17:53:49.522260 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m17:53:49.523431 [debug] [Thread-1  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */
alter table "nyc_taxi_db"."public"."trip_summary_per_hour" rename to "trip_summary_per_hour__dbt_backup"
[0m17:53:49.524829 [debug] [Thread-2  ]: On model.nyc_taxi.high_value_customers: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.high_value_customers"} */
alter table "nyc_taxi_db"."public"."high_value_customers" rename to "high_value_customers__dbt_backup"
[0m17:53:49.527880 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:53:49.528117 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:53:49.533976 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m17:53:49.538791 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m17:53:49.539935 [debug] [Thread-1  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */
alter table "nyc_taxi_db"."public"."trip_summary_per_hour__dbt_tmp" rename to "trip_summary_per_hour"
[0m17:53:49.540992 [debug] [Thread-2  ]: On model.nyc_taxi.high_value_customers: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.high_value_customers"} */
alter table "nyc_taxi_db"."public"."high_value_customers__dbt_tmp" rename to "high_value_customers"
[0m17:53:49.542938 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:53:49.547374 [debug] [Thread-1  ]: On model.nyc_taxi.trip_summary_per_hour: COMMIT
[0m17:53:49.547593 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:53:49.548397 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m17:53:49.552425 [debug] [Thread-2  ]: On model.nyc_taxi.high_value_customers: COMMIT
[0m17:53:49.553683 [debug] [Thread-1  ]: On model.nyc_taxi.trip_summary_per_hour: COMMIT
[0m17:53:49.554809 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m17:53:49.556824 [debug] [Thread-2  ]: On model.nyc_taxi.high_value_customers: COMMIT
[0m17:53:49.560137 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m17:53:49.564063 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m17:53:49.564287 [debug] [Thread-2  ]: SQL status: COMMIT in 0.01 seconds
[0m17:53:49.565177 [debug] [Thread-1  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */
drop table if exists "nyc_taxi_db"."public"."trip_summary_per_hour__dbt_backup" cascade
[0m17:53:49.569187 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m17:53:49.572934 [debug] [Thread-2  ]: On model.nyc_taxi.high_value_customers: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.high_value_customers"} */
drop table if exists "nyc_taxi_db"."public"."high_value_customers__dbt_backup" cascade
[0m17:53:49.577974 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.01 seconds
[0m17:53:49.581127 [debug] [Thread-1  ]: finished collecting timing info
[0m17:53:49.581377 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.01 seconds
[0m17:53:49.582338 [debug] [Thread-1  ]: On model.nyc_taxi.trip_summary_per_hour: Close
[0m17:53:49.584977 [debug] [Thread-2  ]: finished collecting timing info
[0m17:53:49.588126 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '845a505e-1869-44b7-a551-e5839a861cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7500065a90>]}
[0m17:53:49.589043 [debug] [Thread-2  ]: On model.nyc_taxi.high_value_customers: Close
[0m17:53:49.590893 [info ] [Thread-1  ]: 5 of 5 OK created sql table model public.trip_summary_per_hour ................. [[32mSELECT 30[0m in 60.15s]
[0m17:53:49.593280 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '845a505e-1869-44b7-a551-e5839a861cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f750015aeb0>]}
[0m17:53:49.594724 [debug] [Thread-1  ]: Finished running node model.nyc_taxi.trip_summary_per_hour
[0m17:53:49.595990 [info ] [Thread-2  ]: 4 of 5 OK created sql table model public.high_value_customers .................. [[32mSELECT 524[0m in 60.16s]
[0m17:53:49.598638 [debug] [Thread-2  ]: Finished running node model.nyc_taxi.high_value_customers
[0m17:53:49.604445 [debug] [MainThread]: Acquiring new postgres connection "master"
[0m17:53:49.605819 [debug] [MainThread]: Using postgres connection "master"
[0m17:53:49.606797 [debug] [MainThread]: On master: BEGIN
[0m17:53:49.607772 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:53:49.620654 [debug] [MainThread]: SQL status: BEGIN in 0.01 seconds
[0m17:53:49.622282 [debug] [MainThread]: On master: COMMIT
[0m17:53:49.623571 [debug] [MainThread]: Using postgres connection "master"
[0m17:53:49.624787 [debug] [MainThread]: On master: COMMIT
[0m17:53:49.626065 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m17:53:49.627112 [debug] [MainThread]: On master: Close
[0m17:53:49.629889 [info ] [MainThread]: 
[0m17:53:49.631189 [info ] [MainThread]: Finished running 2 view models, 3 table models in 0 hours 3 minutes and 3.57 seconds (183.57s).
[0m17:53:49.632714 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:53:49.634007 [debug] [MainThread]: Connection 'model.nyc_taxi.trip_summary_per_hour' was properly closed.
[0m17:53:49.635088 [debug] [MainThread]: Connection 'model.nyc_taxi.high_value_customers' was properly closed.
[0m17:53:49.636328 [debug] [MainThread]: Connection 'model.nyc_taxi.trip_enriched' was properly closed.
[0m17:53:49.659943 [info ] [MainThread]: 
[0m17:53:49.661569 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:53:49.663305 [info ] [MainThread]: 
[0m17:53:49.665107 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m17:53:49.666972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7500073880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f750087f640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f750007d820>]}
[0m17:53:49.668400 [debug] [MainThread]: Flushing usage events


============================== 2025-05-21 20:14:37.372151 | 11d96e05-c51d-4701-894a-ae0e1eaa8b61 ==============================
[0m20:14:37.372936 [info ] [MainThread]: Running with dbt=1.3.0
[0m20:14:37.375369 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/usr/app/dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m20:14:37.376821 [debug] [MainThread]: Tracking: tracking
[0m20:14:37.389301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6f4f0c9880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6f4f0c9760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6f4f0c97c0>]}
[0m20:14:37.864662 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:14:37.866153 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:14:37.890227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '11d96e05-c51d-4701-894a-ae0e1eaa8b61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6f4ed230d0>]}
[0m20:14:37.925451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '11d96e05-c51d-4701-894a-ae0e1eaa8b61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6f4edc7430>]}
[0m20:14:37.927078 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 289 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m20:14:37.928695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '11d96e05-c51d-4701-894a-ae0e1eaa8b61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6f4edc7460>]}
[0m20:14:37.933774 [info ] [MainThread]: 
[0m20:14:37.937646 [debug] [MainThread]: Acquiring new postgres connection "master"
[0m20:14:37.944954 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db"
[0m20:14:38.030414 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db"
[0m20:14:38.031847 [debug] [ThreadPool]: On list_nyc_taxi_db: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db"} */

    select distinct nspname from pg_namespace
  
[0m20:14:38.033027 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:14:38.071599 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.04 seconds
[0m20:14:38.076111 [debug] [ThreadPool]: On list_nyc_taxi_db: Close
[0m20:14:38.081336 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db_public"
[0m20:14:38.094553 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m20:14:38.096697 [debug] [ThreadPool]: On list_nyc_taxi_db_public: BEGIN
[0m20:14:38.097745 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:14:38.109209 [debug] [ThreadPool]: SQL status: BEGIN in 0.01 seconds
[0m20:14:38.110679 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m20:14:38.111905 [debug] [ThreadPool]: On list_nyc_taxi_db_public: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db_public"} */
select
      'nyc_taxi_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'nyc_taxi_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
[0m20:14:38.124319 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.01 seconds
[0m20:14:38.128659 [debug] [ThreadPool]: On list_nyc_taxi_db_public: ROLLBACK
[0m20:14:38.130317 [debug] [ThreadPool]: On list_nyc_taxi_db_public: Close
[0m20:14:38.142533 [debug] [MainThread]: Using postgres connection "master"
[0m20:14:38.143902 [debug] [MainThread]: On master: BEGIN
[0m20:14:38.145016 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:14:38.155487 [debug] [MainThread]: SQL status: BEGIN in 0.01 seconds
[0m20:14:38.156877 [debug] [MainThread]: Using postgres connection "master"
[0m20:14:38.158342 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:14:38.187627 [debug] [MainThread]: SQL status: SELECT 2 in 0.03 seconds
[0m20:14:38.191273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '11d96e05-c51d-4701-894a-ae0e1eaa8b61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6f4ed69df0>]}
[0m20:14:38.192744 [debug] [MainThread]: On master: ROLLBACK
[0m20:14:38.194181 [debug] [MainThread]: Using postgres connection "master"
[0m20:14:38.195370 [debug] [MainThread]: On master: BEGIN
[0m20:14:38.197114 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:14:38.198089 [debug] [MainThread]: On master: COMMIT
[0m20:14:38.198995 [debug] [MainThread]: Using postgres connection "master"
[0m20:14:38.199951 [debug] [MainThread]: On master: COMMIT
[0m20:14:38.201459 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m20:14:38.202618 [debug] [MainThread]: On master: Close
[0m20:14:38.204477 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:14:38.206046 [info ] [MainThread]: 
[0m20:14:38.241499 [debug] [Thread-1  ]: Began running node model.nyc_taxi.source_dim_weather
[0m20:14:38.242036 [debug] [Thread-2  ]: Began running node model.nyc_taxi.source_fact_taxi_trips
[0m20:14:38.245494 [info ] [Thread-2  ]: 2 of 5 START sql view model public.source_fact_taxi_trips ...................... [RUN]
[0m20:14:38.243513 [info ] [Thread-1  ]: 1 of 5 START sql view model public.source_dim_weather .......................... [RUN]
[0m20:14:38.248075 [debug] [Thread-2  ]: Acquiring new postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m20:14:38.250185 [debug] [Thread-1  ]: Acquiring new postgres connection "model.nyc_taxi.source_dim_weather"
[0m20:14:38.252170 [debug] [Thread-2  ]: Began compiling node model.nyc_taxi.source_fact_taxi_trips
[0m20:14:38.255480 [debug] [Thread-1  ]: Began compiling node model.nyc_taxi.source_dim_weather
[0m20:14:38.256794 [debug] [Thread-2  ]: Compiling model.nyc_taxi.source_fact_taxi_trips
[0m20:14:38.258280 [debug] [Thread-1  ]: Compiling model.nyc_taxi.source_dim_weather
[0m20:14:38.266284 [debug] [Thread-2  ]: Writing injected SQL for node "model.nyc_taxi.source_fact_taxi_trips"
[0m20:14:38.273826 [debug] [Thread-1  ]: Writing injected SQL for node "model.nyc_taxi.source_dim_weather"
[0m20:14:38.282459 [debug] [Thread-2  ]: finished collecting timing info
[0m20:14:38.284207 [debug] [Thread-2  ]: Began executing node model.nyc_taxi.source_fact_taxi_trips
[0m20:14:38.284610 [debug] [Thread-1  ]: finished collecting timing info
[0m20:14:38.310318 [debug] [Thread-1  ]: Began executing node model.nyc_taxi.source_dim_weather
[0m20:14:38.439669 [debug] [Thread-1  ]: Writing runtime sql for node "model.nyc_taxi.source_dim_weather"
[0m20:14:38.440778 [debug] [Thread-2  ]: Writing runtime sql for node "model.nyc_taxi.source_fact_taxi_trips"
[0m20:14:38.455155 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m20:14:38.459621 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: BEGIN
[0m20:14:38.461416 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m20:14:38.462826 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m20:14:38.465018 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: BEGIN
[0m20:14:38.466332 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m20:14:38.477511 [debug] [Thread-2  ]: SQL status: BEGIN in 0.02 seconds
[0m20:14:38.479310 [debug] [Thread-1  ]: SQL status: BEGIN in 0.01 seconds
[0m20:14:38.481838 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m20:14:38.479882 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m20:14:38.483090 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */

  create view "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" as (
    

SELECT
    timestamp,
    temperature,
    humidity,
    wind_speed,
    weather_condition,
    weather_description,
    weather_category,
    hour_of_day,
    day_of_week
FROM
    "nyc_taxi_db"."public"."dim_weather"
  );
[0m20:14:38.484437 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */

  create view "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" as (
    

SELECT
    pickup_datetime,
    dropoff_datetime,
    trip_duration_minutes,
    distance_km,
    distance_bucket,
    fare_amount,
    tip_amount,
    tip_percentage,
    payment_type,
    pickup_hour,
    pickup_day_of_week,
    passenger_count,
    pickup_location_id,
    dropoff_location_id
FROM
    "nyc_taxi_db"."public"."fact_taxi_trips"
  );
[0m20:14:38.519079 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.03 seconds
[0m20:14:38.519409 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.03 seconds
[0m20:14:38.533486 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m20:14:38.537961 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m20:14:38.539235 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
alter table "nyc_taxi_db"."public"."source_dim_weather" rename to "source_dim_weather__dbt_backup"
[0m20:14:38.542725 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
alter table "nyc_taxi_db"."public"."source_fact_taxi_trips" rename to "source_fact_taxi_trips__dbt_backup"
[0m20:14:38.548515 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:14:38.548856 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:14:38.556250 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m20:14:38.563475 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m20:14:38.564345 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
alter table "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" rename to "source_dim_weather"
[0m20:14:38.565459 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
alter table "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" rename to "source_fact_taxi_trips"
[0m20:14:38.567456 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:14:38.568471 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:14:38.639398 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m20:14:38.642288 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m20:14:38.643848 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m20:14:38.645468 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m20:14:38.646850 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m20:14:38.648003 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m20:14:38.651310 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m20:14:38.652562 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m20:14:38.664822 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m20:14:38.671421 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m20:14:38.672558 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
drop view if exists "nyc_taxi_db"."public"."source_dim_weather__dbt_backup" cascade
[0m20:14:38.673978 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
drop view if exists "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_backup" cascade
[0m20:14:38.694256 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.02 seconds
[0m20:14:38.695180 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.02 seconds
[0m20:14:38.698453 [debug] [Thread-1  ]: finished collecting timing info
[0m20:14:38.702627 [debug] [Thread-2  ]: finished collecting timing info
[0m20:14:38.707006 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: Close
[0m20:14:38.709066 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: Close
[0m20:14:38.711994 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11d96e05-c51d-4701-894a-ae0e1eaa8b61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6f4e9dc0a0>]}
[0m20:14:38.714287 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11d96e05-c51d-4701-894a-ae0e1eaa8b61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6f4e9ae1f0>]}
[0m20:14:38.715865 [info ] [Thread-1  ]: 1 of 5 OK created sql view model public.source_dim_weather ..................... [[32mCREATE VIEW[0m in 0.46s]
[0m20:14:38.722849 [info ] [Thread-2  ]: 2 of 5 OK created sql view model public.source_fact_taxi_trips ................. [[32mCREATE VIEW[0m in 0.47s]
[0m20:14:38.725582 [debug] [Thread-1  ]: Finished running node model.nyc_taxi.source_dim_weather
[0m20:14:38.727956 [debug] [Thread-2  ]: Finished running node model.nyc_taxi.source_fact_taxi_trips
[0m20:14:38.733373 [debug] [Thread-4  ]: Began running node model.nyc_taxi.trip_enriched
[0m20:14:38.735087 [info ] [Thread-4  ]: 3 of 5 START sql table model public.trip_enriched .............................. [RUN]
[0m20:14:38.737355 [debug] [Thread-4  ]: Acquiring new postgres connection "model.nyc_taxi.trip_enriched"
[0m20:14:38.738729 [debug] [Thread-4  ]: Began compiling node model.nyc_taxi.trip_enriched
[0m20:14:38.739903 [debug] [Thread-4  ]: Compiling model.nyc_taxi.trip_enriched
[0m20:14:38.752589 [debug] [Thread-4  ]: Writing injected SQL for node "model.nyc_taxi.trip_enriched"
[0m20:14:38.767137 [debug] [Thread-4  ]: finished collecting timing info
[0m20:14:38.768749 [debug] [Thread-4  ]: Began executing node model.nyc_taxi.trip_enriched
[0m20:14:38.848702 [debug] [Thread-4  ]: Writing runtime sql for node "model.nyc_taxi.trip_enriched"
[0m20:14:38.863877 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m20:14:38.865396 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: BEGIN
[0m20:14:38.867003 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m20:14:38.885229 [debug] [Thread-4  ]: SQL status: BEGIN in 0.02 seconds
[0m20:14:38.887561 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m20:14:38.889504 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */

  
    

  create  table "nyc_taxi_db"."public"."trip_enriched__dbt_tmp"
  as (
    

WITH taxi_trips AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_fact_taxi_trips"
),

weather AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_dim_weather"
)

SELECT
    t.pickup_datetime,
    t.dropoff_datetime,
    t.trip_duration_minutes,
    t.distance_km,
    t.distance_bucket,
    t.fare_amount,
    t.tip_amount,
    t.tip_percentage,
    t.payment_type,
    t.pickup_hour,
    t.pickup_day_of_week,
    t.passenger_count,
    t.pickup_location_id,
    t.dropoff_location_id,
    w.temperature,
    w.humidity,
    w.wind_speed,
    w.weather_condition,
    w.weather_category
FROM
    taxi_trips t
LEFT JOIN
    weather w
    -- Join on the closest weather observation by hour
    ON t.pickup_hour = w.hour_of_day
    AND t.pickup_day_of_week = w.day_of_week
  );
  
[0m20:27:10.105262 [debug] [MainThread]: Acquiring new postgres connection "master"
[0m20:27:10.173295 [debug] [MainThread]: Postgres adapter: Cancelling query 'model.nyc_taxi.trip_enriched' (2039)
[0m20:27:10.190973 [debug] [MainThread]: Using postgres connection "master"
[0m20:27:10.194320 [debug] [MainThread]: On master: BEGIN
[0m20:27:10.200101 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:27:10.341676 [debug] [MainThread]: SQL status: BEGIN in 0.14 seconds
[0m20:27:10.343849 [debug] [MainThread]: Using postgres connection "master"
[0m20:27:10.344917 [debug] [MainThread]: On master: select pg_terminate_backend(2039)
[0m20:27:10.356872 [debug] [MainThread]: SQL status: SELECT 1 in 0.01 seconds
[0m20:27:10.361964 [debug] [MainThread]: Postgres adapter: Cancel query 'model.nyc_taxi.trip_enriched': (True,)
[0m20:27:10.396517 [error] [MainThread]: CANCEL query model.nyc_taxi.source_dim_weather ................................. [[31mCANCEL[0m]
[0m20:27:10.409221 [error] [MainThread]: CANCEL query model.nyc_taxi.source_fact_taxi_trips ............................. [[31mCANCEL[0m]
[0m20:27:10.411178 [error] [MainThread]: CANCEL query model.nyc_taxi.trip_enriched ...................................... [[31mCANCEL[0m]
[0m20:27:10.417252 [debug] [MainThread]: On master: ROLLBACK
[0m20:27:10.420338 [debug] [MainThread]: On master: Close
[0m20:27:10.468547 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:27:10.469962 [debug] [MainThread]: Connection 'model.nyc_taxi.source_dim_weather' was properly closed.
[0m20:27:10.471434 [debug] [MainThread]: Connection 'model.nyc_taxi.source_fact_taxi_trips' was properly closed.
[0m20:27:10.473460 [debug] [MainThread]: Connection 'model.nyc_taxi.trip_enriched' was left open.
[0m20:27:10.474477 [debug] [MainThread]: On model.nyc_taxi.trip_enriched: ROLLBACK
[0m20:27:11.901392 [debug] [Thread-4  ]: Postgres adapter: Postgres error: server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.

[0m20:27:11.903040 [debug] [MainThread]: Failed to rollback 'model.nyc_taxi.trip_enriched'
[0m20:27:11.905535 [debug] [MainThread]: On model.nyc_taxi.trip_enriched: Close
[0m20:27:11.923361 [debug] [MainThread]: Flushing usage events
[0m20:27:11.969268 [debug] [Thread-4  ]: finished collecting timing info
[0m20:27:12.039080 [debug] [Thread-4  ]: Database Error in model trip_enriched (models/intermediate/trip_enriched.sql)
  server closed the connection unexpectedly
  	This probably means the server terminated abnormally
  	before or while processing the request.
  compiled Code at target/run/nyc_taxi/models/intermediate/trip_enriched.sql
[0m20:27:12.132923 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11d96e05-c51d-4701-894a-ae0e1eaa8b61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6f4e968be0>]}
[0m20:27:13.249272 [info ] [MainThread]: ctrl-c
[0m20:27:13.266286 [error] [Thread-4  ]: 3 of 5 ERROR creating sql table model public.trip_enriched ..................... [[31mERROR[0m in 753.33s]


============================== 2025-05-21 20:31:19.206586 | 2b02055b-fd22-436e-9189-1ce7d2e53752 ==============================
[0m20:31:19.206624 [info ] [MainThread]: Running with dbt=1.3.0
[0m20:31:19.207891 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/usr/app/dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m20:31:19.209106 [debug] [MainThread]: Tracking: tracking
[0m20:31:19.221832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5441bf0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5441bf0400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5441bf03a0>]}
[0m20:31:19.547154 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:31:19.548563 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:31:19.560874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2b02055b-fd22-436e-9189-1ce7d2e53752', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f544175f0d0>]}
[0m20:31:19.586494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2b02055b-fd22-436e-9189-1ce7d2e53752', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f54417ba220>]}
[0m20:31:19.587949 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 289 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m20:31:19.589320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2b02055b-fd22-436e-9189-1ce7d2e53752', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f54417ba040>]}
[0m20:31:19.597647 [info ] [MainThread]: 
[0m20:31:19.599690 [debug] [MainThread]: Acquiring new postgres connection "master"
[0m20:31:19.603122 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db"
[0m20:31:19.624445 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db"
[0m20:31:19.625781 [debug] [ThreadPool]: On list_nyc_taxi_db: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db"} */

    select distinct nspname from pg_namespace
  
[0m20:31:19.626789 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:31:19.653996 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.03 seconds
[0m20:31:19.656957 [debug] [ThreadPool]: On list_nyc_taxi_db: Close
[0m20:31:19.660490 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db_public"
[0m20:31:19.671212 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m20:31:19.672771 [debug] [ThreadPool]: On list_nyc_taxi_db_public: BEGIN
[0m20:31:19.673763 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:31:19.682186 [debug] [ThreadPool]: SQL status: BEGIN in 0.01 seconds
[0m20:31:19.683466 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m20:31:19.684532 [debug] [ThreadPool]: On list_nyc_taxi_db_public: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db_public"} */
select
      'nyc_taxi_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'nyc_taxi_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
[0m20:31:19.704783 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.02 seconds
[0m20:31:19.753878 [debug] [ThreadPool]: On list_nyc_taxi_db_public: ROLLBACK
[0m20:31:19.755567 [debug] [ThreadPool]: On list_nyc_taxi_db_public: Close
[0m20:31:19.765184 [debug] [MainThread]: Using postgres connection "master"
[0m20:31:19.766485 [debug] [MainThread]: On master: BEGIN
[0m20:31:19.767420 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:31:19.777489 [debug] [MainThread]: SQL status: BEGIN in 0.01 seconds
[0m20:31:19.778601 [debug] [MainThread]: Using postgres connection "master"
[0m20:31:19.779619 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:31:19.824652 [debug] [MainThread]: SQL status: SELECT 2 in 0.04 seconds
[0m20:31:19.827926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2b02055b-fd22-436e-9189-1ce7d2e53752', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f54416a5df0>]}
[0m20:31:19.829345 [debug] [MainThread]: On master: ROLLBACK
[0m20:31:19.830925 [debug] [MainThread]: Using postgres connection "master"
[0m20:31:19.832073 [debug] [MainThread]: On master: BEGIN
[0m20:31:19.833884 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m20:31:19.835092 [debug] [MainThread]: On master: COMMIT
[0m20:31:19.836208 [debug] [MainThread]: Using postgres connection "master"
[0m20:31:19.837278 [debug] [MainThread]: On master: COMMIT
[0m20:31:19.838565 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m20:31:19.839835 [debug] [MainThread]: On master: Close
[0m20:31:19.841748 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:31:19.843118 [info ] [MainThread]: 
[0m20:31:19.854699 [debug] [Thread-1  ]: Began running node model.nyc_taxi.source_dim_weather
[0m20:31:19.855131 [debug] [Thread-2  ]: Began running node model.nyc_taxi.source_fact_taxi_trips
[0m20:31:19.856381 [info ] [Thread-1  ]: 1 of 5 START sql view model public.source_dim_weather .......................... [RUN]
[0m20:31:19.858256 [info ] [Thread-2  ]: 2 of 5 START sql view model public.source_fact_taxi_trips ...................... [RUN]
[0m20:31:19.860698 [debug] [Thread-1  ]: Acquiring new postgres connection "model.nyc_taxi.source_dim_weather"
[0m20:31:19.862577 [debug] [Thread-2  ]: Acquiring new postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m20:31:19.863858 [debug] [Thread-1  ]: Began compiling node model.nyc_taxi.source_dim_weather
[0m20:31:19.865477 [debug] [Thread-2  ]: Began compiling node model.nyc_taxi.source_fact_taxi_trips
[0m20:31:19.866978 [debug] [Thread-1  ]: Compiling model.nyc_taxi.source_dim_weather
[0m20:31:19.868067 [debug] [Thread-2  ]: Compiling model.nyc_taxi.source_fact_taxi_trips
[0m20:31:19.876499 [debug] [Thread-1  ]: Writing injected SQL for node "model.nyc_taxi.source_dim_weather"
[0m20:31:19.884749 [debug] [Thread-2  ]: Writing injected SQL for node "model.nyc_taxi.source_fact_taxi_trips"
[0m20:31:19.894057 [debug] [Thread-1  ]: finished collecting timing info
[0m20:31:19.897571 [debug] [Thread-1  ]: Began executing node model.nyc_taxi.source_dim_weather
[0m20:31:19.898825 [debug] [Thread-2  ]: finished collecting timing info
[0m20:31:19.924226 [debug] [Thread-2  ]: Began executing node model.nyc_taxi.source_fact_taxi_trips
[0m20:31:20.057950 [debug] [Thread-1  ]: Writing runtime sql for node "model.nyc_taxi.source_dim_weather"
[0m20:31:20.058713 [debug] [Thread-2  ]: Writing runtime sql for node "model.nyc_taxi.source_fact_taxi_trips"
[0m20:31:20.067436 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m20:31:20.069039 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m20:31:20.069406 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: BEGIN
[0m20:31:20.070593 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: BEGIN
[0m20:31:20.071545 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m20:31:20.072489 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m20:31:20.080812 [debug] [Thread-1  ]: SQL status: BEGIN in 0.01 seconds
[0m20:31:20.081119 [debug] [Thread-2  ]: SQL status: BEGIN in 0.01 seconds
[0m20:31:20.081989 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m20:31:20.082931 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m20:31:20.083862 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */

  create view "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" as (
    

SELECT
    timestamp,
    temperature,
    humidity,
    wind_speed,
    weather_condition,
    weather_description,
    weather_category,
    hour_of_day,
    day_of_week
FROM
    "nyc_taxi_db"."public"."dim_weather"
  );
[0m20:31:20.084780 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */

  create view "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" as (
    

SELECT
    pickup_datetime,
    dropoff_datetime,
    trip_duration_minutes,
    distance_km,
    distance_bucket,
    fare_amount,
    tip_amount,
    tip_percentage,
    payment_type,
    pickup_hour,
    pickup_day_of_week,
    passenger_count,
    pickup_location_id,
    dropoff_location_id
FROM
    "nyc_taxi_db"."public"."fact_taxi_trips"
  );
[0m20:31:20.104375 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.02 seconds
[0m20:31:20.104887 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.02 seconds
[0m20:31:20.121028 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m20:31:20.126629 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m20:31:20.128145 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
alter table "nyc_taxi_db"."public"."source_dim_weather" rename to "source_dim_weather__dbt_backup"
[0m20:31:20.129437 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
alter table "nyc_taxi_db"."public"."source_fact_taxi_trips" rename to "source_fact_taxi_trips__dbt_backup"
[0m20:31:20.135637 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:31:20.136098 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:31:20.141950 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m20:31:20.148300 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m20:31:20.149830 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
alter table "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" rename to "source_dim_weather"
[0m20:31:20.151243 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
alter table "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" rename to "source_fact_taxi_trips"
[0m20:31:20.153331 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:31:20.154200 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m20:31:20.222621 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m20:31:20.227663 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m20:31:20.228904 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m20:31:20.230475 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m20:31:20.231800 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m20:31:20.232984 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m20:31:20.236705 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m20:31:20.243696 [debug] [Thread-2  ]: SQL status: COMMIT in 0.01 seconds
[0m20:31:20.248566 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m20:31:20.253138 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m20:31:20.255040 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
drop view if exists "nyc_taxi_db"."public"."source_dim_weather__dbt_backup" cascade
[0m20:31:20.256627 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
drop view if exists "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_backup" cascade
[0m20:31:20.272641 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.01 seconds
[0m20:31:20.273675 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.01 seconds
[0m20:31:20.275588 [debug] [Thread-1  ]: finished collecting timing info
[0m20:31:20.278005 [debug] [Thread-2  ]: finished collecting timing info
[0m20:31:20.278976 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: Close
[0m20:31:20.280190 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: Close
[0m20:31:20.281996 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b02055b-fd22-436e-9189-1ce7d2e53752', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f54417315e0>]}
[0m20:31:20.283478 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b02055b-fd22-436e-9189-1ce7d2e53752', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f54416c2f70>]}
[0m20:31:20.284688 [info ] [Thread-1  ]: 1 of 5 OK created sql view model public.source_dim_weather ..................... [[32mCREATE VIEW[0m in 0.42s]
[0m20:31:20.286289 [info ] [Thread-2  ]: 2 of 5 OK created sql view model public.source_fact_taxi_trips ................. [[32mCREATE VIEW[0m in 0.42s]
[0m20:31:20.287690 [debug] [Thread-1  ]: Finished running node model.nyc_taxi.source_dim_weather
[0m20:31:20.288934 [debug] [Thread-2  ]: Finished running node model.nyc_taxi.source_fact_taxi_trips
[0m20:31:20.292827 [debug] [Thread-4  ]: Began running node model.nyc_taxi.trip_enriched
[0m20:31:20.294541 [info ] [Thread-4  ]: 3 of 5 START sql table model public.trip_enriched .............................. [RUN]
[0m20:31:20.297392 [debug] [Thread-4  ]: Acquiring new postgres connection "model.nyc_taxi.trip_enriched"
[0m20:31:20.298924 [debug] [Thread-4  ]: Began compiling node model.nyc_taxi.trip_enriched
[0m20:31:20.300079 [debug] [Thread-4  ]: Compiling model.nyc_taxi.trip_enriched
[0m20:31:20.307452 [debug] [Thread-4  ]: Writing injected SQL for node "model.nyc_taxi.trip_enriched"
[0m20:31:20.320529 [debug] [Thread-4  ]: finished collecting timing info
[0m20:31:20.321716 [debug] [Thread-4  ]: Began executing node model.nyc_taxi.trip_enriched
[0m20:31:20.364968 [debug] [Thread-4  ]: Writing runtime sql for node "model.nyc_taxi.trip_enriched"
[0m20:31:20.376743 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m20:31:20.378051 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: BEGIN
[0m20:31:20.380928 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m20:31:20.390331 [debug] [Thread-4  ]: SQL status: BEGIN in 0.01 seconds
[0m20:31:20.391553 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m20:31:20.392577 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */

  
    

  create  table "nyc_taxi_db"."public"."trip_enriched__dbt_tmp"
  as (
    

WITH taxi_trips AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_fact_taxi_trips"
),

weather AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_dim_weather"
)

SELECT
    t.pickup_datetime,
    t.dropoff_datetime,
    t.trip_duration_minutes,
    t.distance_km,
    t.distance_bucket,
    t.fare_amount,
    t.tip_amount,
    t.tip_percentage,
    t.payment_type,
    t.pickup_hour,
    t.pickup_day_of_week,
    t.passenger_count,
    t.pickup_location_id,
    t.dropoff_location_id,
    w.temperature,
    w.humidity,
    w.wind_speed,
    w.weather_condition,
    w.weather_category
FROM
    taxi_trips t
LEFT JOIN
    weather w
    -- Join on the closest weather observation by hour
    ON t.pickup_hour = w.hour_of_day
    AND t.pickup_day_of_week = w.day_of_week
  );
  


============================== 2025-05-22 06:37:15.079445 | fa76493a-81c8-49e8-bd6a-eee273473729 ==============================
[0m06:37:15.079685 [info ] [MainThread]: Running with dbt=1.3.0
[0m06:37:15.082114 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/usr/app/dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'config_dir': False, 'which': 'debug', 'indirect_selection': 'eager'}
[0m06:37:15.084029 [debug] [MainThread]: Tracking: tracking
[0m06:37:15.110915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9eeccc0a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9eecccc3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9eecccc250>]}
[0m06:37:15.527492 [debug] [MainThread]: Executing "git --help"
[0m06:37:15.548749 [debug] [MainThread]: Acquiring new postgres connection "debug"
[0m06:37:15.551451 [debug] [MainThread]: Using postgres connection "debug"
[0m06:37:15.552964 [debug] [MainThread]: On debug: select 1 as id
[0m06:37:15.554339 [debug] [MainThread]: Opening a new connection, currently in state init
[0m06:37:15.683802 [debug] [MainThread]: SQL status: SELECT 1 in 0.13 seconds
[0m06:37:15.688653 [debug] [MainThread]: On debug: Close
[0m06:37:15.691637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9eecd37e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9eec72fe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9eec72fdf0>]}
[0m06:37:15.694347 [debug] [MainThread]: Flushing usage events
[0m06:37:16.221119 [debug] [MainThread]: Connection 'debug' was properly closed.


============================== 2025-05-22 07:41:56.316302 | 9714b60b-2ebe-496b-adbe-c526bd15e958 ==============================
[0m07:41:56.316354 [info ] [MainThread]: Running with dbt=1.3.0
[0m07:41:56.318354 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/usr/app/dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m07:41:56.319568 [debug] [MainThread]: Tracking: tracking
[0m07:41:56.329312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf6ff8e880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf6ff8e760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf6ff8e7c0>]}
[0m07:41:56.700227 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:41:56.701792 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:41:56.717118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9714b60b-2ebe-496b-adbe-c526bd15e958', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf6fe630d0>]}
[0m07:41:56.744723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9714b60b-2ebe-496b-adbe-c526bd15e958', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf6ff07400>]}
[0m07:41:56.746273 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 289 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m07:41:56.747681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9714b60b-2ebe-496b-adbe-c526bd15e958', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf6ff071c0>]}
[0m07:41:56.753245 [info ] [MainThread]: 
[0m07:41:56.756087 [debug] [MainThread]: Acquiring new postgres connection "master"
[0m07:41:56.760439 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db"
[0m07:41:56.824590 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db"
[0m07:41:56.825714 [debug] [ThreadPool]: On list_nyc_taxi_db: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db"} */

    select distinct nspname from pg_namespace
  
[0m07:41:56.826646 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:41:56.855722 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.03 seconds
[0m07:41:56.858370 [debug] [ThreadPool]: On list_nyc_taxi_db: Close
[0m07:41:56.862017 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db_public"
[0m07:41:56.871330 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m07:41:56.872362 [debug] [ThreadPool]: On list_nyc_taxi_db_public: BEGIN
[0m07:41:56.873213 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:41:56.881134 [debug] [ThreadPool]: SQL status: BEGIN in 0.01 seconds
[0m07:41:56.882356 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m07:41:56.883232 [debug] [ThreadPool]: On list_nyc_taxi_db_public: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db_public"} */
select
      'nyc_taxi_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'nyc_taxi_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
[0m07:41:56.896199 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.01 seconds
[0m07:41:56.898934 [debug] [ThreadPool]: On list_nyc_taxi_db_public: ROLLBACK
[0m07:41:56.900183 [debug] [ThreadPool]: On list_nyc_taxi_db_public: Close
[0m07:41:56.907205 [debug] [MainThread]: Using postgres connection "master"
[0m07:41:56.908228 [debug] [MainThread]: On master: BEGIN
[0m07:41:56.909303 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:41:56.916420 [debug] [MainThread]: SQL status: BEGIN in 0.01 seconds
[0m07:41:56.917555 [debug] [MainThread]: Using postgres connection "master"
[0m07:41:56.918772 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m07:41:56.942870 [debug] [MainThread]: SQL status: SELECT 2 in 0.02 seconds
[0m07:41:56.945449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9714b60b-2ebe-496b-adbe-c526bd15e958', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf6fea8d90>]}
[0m07:41:56.946535 [debug] [MainThread]: On master: ROLLBACK
[0m07:41:56.947660 [debug] [MainThread]: Using postgres connection "master"
[0m07:41:56.948835 [debug] [MainThread]: On master: BEGIN
[0m07:41:56.950239 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m07:41:56.951119 [debug] [MainThread]: On master: COMMIT
[0m07:41:56.951921 [debug] [MainThread]: Using postgres connection "master"
[0m07:41:56.952769 [debug] [MainThread]: On master: COMMIT
[0m07:41:56.953932 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m07:41:56.954862 [debug] [MainThread]: On master: Close
[0m07:41:56.956296 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:41:56.958344 [info ] [MainThread]: 
[0m07:41:56.987651 [debug] [Thread-1  ]: Began running node model.nyc_taxi.source_dim_weather
[0m07:41:56.988255 [debug] [Thread-2  ]: Began running node model.nyc_taxi.source_fact_taxi_trips
[0m07:41:56.991687 [info ] [Thread-1  ]: 1 of 5 START sql view model public.source_dim_weather .......................... [RUN]
[0m07:41:56.992880 [info ] [Thread-2  ]: 2 of 5 START sql view model public.source_fact_taxi_trips ...................... [RUN]
[0m07:41:56.994760 [debug] [Thread-1  ]: Acquiring new postgres connection "model.nyc_taxi.source_dim_weather"
[0m07:41:56.996738 [debug] [Thread-2  ]: Acquiring new postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m07:41:56.997415 [debug] [Thread-1  ]: Began compiling node model.nyc_taxi.source_dim_weather
[0m07:41:56.998990 [debug] [Thread-2  ]: Began compiling node model.nyc_taxi.source_fact_taxi_trips
[0m07:41:57.000140 [debug] [Thread-1  ]: Compiling model.nyc_taxi.source_dim_weather
[0m07:41:57.001257 [debug] [Thread-2  ]: Compiling model.nyc_taxi.source_fact_taxi_trips
[0m07:41:57.011171 [debug] [Thread-1  ]: Writing injected SQL for node "model.nyc_taxi.source_dim_weather"
[0m07:41:57.015961 [debug] [Thread-2  ]: Writing injected SQL for node "model.nyc_taxi.source_fact_taxi_trips"
[0m07:41:57.026318 [debug] [Thread-2  ]: finished collecting timing info
[0m07:41:57.028581 [debug] [Thread-2  ]: Began executing node model.nyc_taxi.source_fact_taxi_trips
[0m07:41:57.029043 [debug] [Thread-1  ]: finished collecting timing info
[0m07:41:57.052051 [debug] [Thread-1  ]: Began executing node model.nyc_taxi.source_dim_weather
[0m07:41:57.149361 [debug] [Thread-2  ]: Writing runtime sql for node "model.nyc_taxi.source_fact_taxi_trips"
[0m07:41:57.150299 [debug] [Thread-1  ]: Writing runtime sql for node "model.nyc_taxi.source_dim_weather"
[0m07:41:57.166392 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m07:41:57.168961 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: BEGIN
[0m07:41:57.170299 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m07:41:57.171073 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m07:41:57.172153 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: BEGIN
[0m07:41:57.175841 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:41:57.184539 [debug] [Thread-2  ]: SQL status: BEGIN in 0.01 seconds
[0m07:41:57.186978 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m07:41:57.189005 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */

  create view "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" as (
    

SELECT
    pickup_datetime,
    dropoff_datetime,
    trip_duration_minutes,
    distance_km,
    distance_bucket,
    fare_amount,
    tip_amount,
    tip_percentage,
    payment_type,
    pickup_hour,
    pickup_day_of_week,
    passenger_count,
    pickup_location_id,
    dropoff_location_id
FROM
    "nyc_taxi_db"."public"."fact_taxi_trips"
  );
[0m07:41:57.190120 [debug] [Thread-1  ]: SQL status: BEGIN in 0.01 seconds
[0m07:41:57.192238 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m07:41:57.193679 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */

  create view "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" as (
    

SELECT
    timestamp,
    temperature,
    humidity,
    wind_speed,
    weather_condition,
    weather_description,
    weather_category,
    hour_of_day,
    day_of_week
FROM
    "nyc_taxi_db"."public"."dim_weather"
  );
[0m07:41:57.223710 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.03 seconds
[0m07:41:57.224044 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.03 seconds
[0m07:41:57.237951 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m07:41:57.242134 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m07:41:57.243478 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
alter table "nyc_taxi_db"."public"."source_fact_taxi_trips" rename to "source_fact_taxi_trips__dbt_backup"
[0m07:41:57.244474 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
alter table "nyc_taxi_db"."public"."source_dim_weather" rename to "source_dim_weather__dbt_backup"
[0m07:41:57.248699 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m07:41:57.249049 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m07:41:57.254160 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m07:41:57.259094 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m07:41:57.260421 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
alter table "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" rename to "source_fact_taxi_trips"
[0m07:41:57.261556 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
alter table "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" rename to "source_dim_weather"
[0m07:41:57.263508 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m07:41:57.264918 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m07:41:57.309184 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m07:41:57.310186 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m07:41:57.310903 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m07:41:57.311825 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m07:41:57.312703 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m07:41:57.313708 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m07:41:57.316740 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m07:41:57.317573 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m07:41:57.324586 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m07:41:57.327494 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m07:41:57.328617 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
drop view if exists "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_backup" cascade
[0m07:41:57.329702 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
drop view if exists "nyc_taxi_db"."public"."source_dim_weather__dbt_backup" cascade
[0m07:41:57.342614 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.01 seconds
[0m07:41:57.342879 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.01 seconds
[0m07:41:57.344977 [debug] [Thread-1  ]: finished collecting timing info
[0m07:41:57.347256 [debug] [Thread-2  ]: finished collecting timing info
[0m07:41:57.348672 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: Close
[0m07:41:57.350031 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: Close
[0m07:41:57.351940 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9714b60b-2ebe-496b-adbe-c526bd15e958', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf6fbdc0a0>]}
[0m07:41:57.353349 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9714b60b-2ebe-496b-adbe-c526bd15e958', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf6fbaeee0>]}
[0m07:41:57.354258 [info ] [Thread-1  ]: 1 of 5 OK created sql view model public.source_dim_weather ..................... [[32mCREATE VIEW[0m in 0.36s]
[0m07:41:57.355474 [info ] [Thread-2  ]: 2 of 5 OK created sql view model public.source_fact_taxi_trips ................. [[32mCREATE VIEW[0m in 0.36s]
[0m07:41:57.356859 [debug] [Thread-1  ]: Finished running node model.nyc_taxi.source_dim_weather
[0m07:41:57.357984 [debug] [Thread-2  ]: Finished running node model.nyc_taxi.source_fact_taxi_trips
[0m07:41:57.360863 [debug] [Thread-4  ]: Began running node model.nyc_taxi.trip_enriched
[0m07:41:57.362098 [info ] [Thread-4  ]: 3 of 5 START sql table model public.trip_enriched .............................. [RUN]
[0m07:41:57.363793 [debug] [Thread-4  ]: Acquiring new postgres connection "model.nyc_taxi.trip_enriched"
[0m07:41:57.364951 [debug] [Thread-4  ]: Began compiling node model.nyc_taxi.trip_enriched
[0m07:41:57.366000 [debug] [Thread-4  ]: Compiling model.nyc_taxi.trip_enriched
[0m07:41:57.371498 [debug] [Thread-4  ]: Writing injected SQL for node "model.nyc_taxi.trip_enriched"
[0m07:41:57.383708 [debug] [Thread-4  ]: finished collecting timing info
[0m07:41:57.384880 [debug] [Thread-4  ]: Began executing node model.nyc_taxi.trip_enriched
[0m07:41:57.422719 [debug] [Thread-4  ]: Writing runtime sql for node "model.nyc_taxi.trip_enriched"
[0m07:41:57.432859 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m07:41:57.433797 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: BEGIN
[0m07:41:57.434715 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m07:41:57.445509 [debug] [Thread-4  ]: SQL status: BEGIN in 0.01 seconds
[0m07:41:57.447326 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m07:41:57.449387 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */

  
    

  create  table "nyc_taxi_db"."public"."trip_enriched__dbt_tmp"
  as (
    

WITH taxi_trips AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_fact_taxi_trips"
),

weather AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_dim_weather"
)

SELECT
    t.pickup_datetime,
    t.dropoff_datetime,
    t.trip_duration_minutes,
    t.distance_km,
    t.distance_bucket,
    t.fare_amount,
    t.tip_amount,
    t.tip_percentage,
    t.payment_type,
    t.pickup_hour,
    t.pickup_day_of_week,
    t.passenger_count,
    t.pickup_location_id,
    t.dropoff_location_id,
    w.temperature,
    w.humidity,
    w.wind_speed,
    w.weather_condition,
    w.weather_category
FROM
    taxi_trips t
LEFT JOIN
    weather w
    -- Join on the closest weather observation by hour
    ON t.pickup_hour = w.hour_of_day
    AND t.pickup_day_of_week = w.day_of_week
  );
  


============================== 2025-05-22 09:00:37.375714 | 1a76b8b4-382c-45d8-979a-3f4d55dc75f4 ==============================
[0m09:00:37.375779 [info ] [MainThread]: Running with dbt=1.3.0
[0m09:00:37.378315 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/usr/app/dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m09:00:37.380111 [debug] [MainThread]: Tracking: tracking
[0m09:00:37.389919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5dc0d3f280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5dc0d3f370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5dc0d3f310>]}
[0m09:00:37.488482 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m09:00:37.490540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1a76b8b4-382c-45d8-979a-3f4d55dc75f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5dc0d1b6d0>]}
[0m09:00:37.828152 [debug] [MainThread]: Parsing macros/timestamps.sql
[0m09:00:37.833642 [debug] [MainThread]: Parsing macros/catalog.sql
[0m09:00:37.837766 [debug] [MainThread]: Parsing macros/adapters.sql
[0m09:00:37.871242 [debug] [MainThread]: Parsing macros/relations.sql
[0m09:00:37.874239 [debug] [MainThread]: Parsing macros/utils/last_day.sql
[0m09:00:37.877239 [debug] [MainThread]: Parsing macros/utils/any_value.sql
[0m09:00:37.879215 [debug] [MainThread]: Parsing macros/utils/dateadd.sql
[0m09:00:37.881494 [debug] [MainThread]: Parsing macros/utils/listagg.sql
[0m09:00:37.884794 [debug] [MainThread]: Parsing macros/utils/datediff.sql
[0m09:00:37.894535 [debug] [MainThread]: Parsing macros/utils/split_part.sql
[0m09:00:37.897103 [debug] [MainThread]: Parsing macros/materializations/snapshot_merge.sql
[0m09:00:37.900536 [debug] [MainThread]: Parsing macros/materializations/incremental_strategies.sql
[0m09:00:37.902611 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_alias.sql
[0m09:00:37.905777 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_database.sql
[0m09:00:37.909158 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_schema.sql
[0m09:00:37.913504 [debug] [MainThread]: Parsing macros/utils/hash.sql
[0m09:00:37.916802 [debug] [MainThread]: Parsing macros/utils/concat.sql
[0m09:00:37.919498 [debug] [MainThread]: Parsing macros/utils/last_day.sql
[0m09:00:37.923907 [debug] [MainThread]: Parsing macros/utils/any_value.sql
[0m09:00:37.926949 [debug] [MainThread]: Parsing macros/utils/cast_bool_to_text.sql
[0m09:00:37.929828 [debug] [MainThread]: Parsing macros/utils/data_types.sql
[0m09:00:37.941581 [debug] [MainThread]: Parsing macros/utils/dateadd.sql
[0m09:00:37.945261 [debug] [MainThread]: Parsing macros/utils/right.sql
[0m09:00:37.948756 [debug] [MainThread]: Parsing macros/utils/literal.sql
[0m09:00:37.951233 [debug] [MainThread]: Parsing macros/utils/except.sql
[0m09:00:37.953607 [debug] [MainThread]: Parsing macros/utils/bool_or.sql
[0m09:00:37.955946 [debug] [MainThread]: Parsing macros/utils/listagg.sql
[0m09:00:37.960684 [debug] [MainThread]: Parsing macros/utils/intersect.sql
[0m09:00:37.962748 [debug] [MainThread]: Parsing macros/utils/date_trunc.sql
[0m09:00:37.965985 [debug] [MainThread]: Parsing macros/utils/datediff.sql
[0m09:00:37.969681 [debug] [MainThread]: Parsing macros/utils/array_append.sql
[0m09:00:37.972635 [debug] [MainThread]: Parsing macros/utils/escape_single_quotes.sql
[0m09:00:37.975147 [debug] [MainThread]: Parsing macros/utils/safe_cast.sql
[0m09:00:37.977896 [debug] [MainThread]: Parsing macros/utils/array_concat.sql
[0m09:00:37.980488 [debug] [MainThread]: Parsing macros/utils/replace.sql
[0m09:00:37.984142 [debug] [MainThread]: Parsing macros/utils/array_construct.sql
[0m09:00:37.989461 [debug] [MainThread]: Parsing macros/utils/split_part.sql
[0m09:00:37.995363 [debug] [MainThread]: Parsing macros/utils/position.sql
[0m09:00:37.999655 [debug] [MainThread]: Parsing macros/utils/length.sql
[0m09:00:38.002320 [debug] [MainThread]: Parsing macros/etc/datetime.sql
[0m09:00:38.017222 [debug] [MainThread]: Parsing macros/etc/statement.sql
[0m09:00:38.027472 [debug] [MainThread]: Parsing macros/generic_test_sql/relationships.sql
[0m09:00:38.029748 [debug] [MainThread]: Parsing macros/generic_test_sql/accepted_values.sql
[0m09:00:38.033278 [debug] [MainThread]: Parsing macros/generic_test_sql/unique.sql
[0m09:00:38.035618 [debug] [MainThread]: Parsing macros/generic_test_sql/not_null.sql
[0m09:00:38.037870 [debug] [MainThread]: Parsing macros/materializations/configs.sql
[0m09:00:38.042795 [debug] [MainThread]: Parsing macros/materializations/hooks.sql
[0m09:00:38.051547 [debug] [MainThread]: Parsing macros/materializations/seeds/seed.sql
[0m09:00:38.064621 [debug] [MainThread]: Parsing macros/materializations/seeds/helpers.sql
[0m09:00:38.094121 [debug] [MainThread]: Parsing macros/materializations/tests/test.sql
[0m09:00:38.101565 [debug] [MainThread]: Parsing macros/materializations/tests/where_subquery.sql
[0m09:00:38.105191 [debug] [MainThread]: Parsing macros/materializations/tests/helpers.sql
[0m09:00:38.108804 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot_merge.sql
[0m09:00:38.112195 [debug] [MainThread]: Parsing macros/materializations/snapshots/strategies.sql
[0m09:00:38.183384 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot.sql
[0m09:00:38.206234 [debug] [MainThread]: Parsing macros/materializations/snapshots/helpers.sql
[0m09:00:38.230517 [debug] [MainThread]: Parsing macros/materializations/models/table/create_table_as.sql
[0m09:00:38.239459 [debug] [MainThread]: Parsing macros/materializations/models/table/table.sql
[0m09:00:38.249421 [debug] [MainThread]: Parsing macros/materializations/models/view/create_or_replace_view.sql
[0m09:00:38.256730 [debug] [MainThread]: Parsing macros/materializations/models/view/view.sql
[0m09:00:38.266960 [debug] [MainThread]: Parsing macros/materializations/models/view/create_view_as.sql
[0m09:00:38.271699 [debug] [MainThread]: Parsing macros/materializations/models/view/helpers.sql
[0m09:00:38.274870 [debug] [MainThread]: Parsing macros/materializations/models/incremental/column_helpers.sql
[0m09:00:38.287825 [debug] [MainThread]: Parsing macros/materializations/models/incremental/merge.sql
[0m09:00:38.310067 [debug] [MainThread]: Parsing macros/materializations/models/incremental/strategies.sql
[0m09:00:38.320269 [debug] [MainThread]: Parsing macros/materializations/models/incremental/on_schema_change.sql
[0m09:00:38.344601 [debug] [MainThread]: Parsing macros/materializations/models/incremental/incremental.sql
[0m09:00:38.360031 [debug] [MainThread]: Parsing macros/materializations/models/incremental/is_incremental.sql
[0m09:00:38.363903 [debug] [MainThread]: Parsing macros/python_model/python.sql
[0m09:00:38.373514 [debug] [MainThread]: Parsing macros/adapters/indexes.sql
[0m09:00:38.377952 [debug] [MainThread]: Parsing macros/adapters/apply_grants.sql
[0m09:00:38.399086 [debug] [MainThread]: Parsing macros/adapters/freshness.sql
[0m09:00:38.402858 [debug] [MainThread]: Parsing macros/adapters/columns.sql
[0m09:00:38.420108 [debug] [MainThread]: Parsing macros/adapters/metadata.sql
[0m09:00:38.431857 [debug] [MainThread]: Parsing macros/adapters/timestamps.sql
[0m09:00:38.439185 [debug] [MainThread]: Parsing macros/adapters/schema.sql
[0m09:00:38.443549 [debug] [MainThread]: Parsing macros/adapters/persist_docs.sql
[0m09:00:38.451368 [debug] [MainThread]: Parsing macros/adapters/relation.sql
[0m09:00:38.473099 [debug] [MainThread]: Parsing tests/generic/builtin.sql
[0m09:00:38.835222 [debug] [MainThread]: 1699: static parser successfully parsed intermediate/trip_enriched.sql
[0m09:00:38.854994 [debug] [MainThread]: 1699: static parser successfully parsed marts/high_value_customers.sql
[0m09:00:38.865696 [debug] [MainThread]: 1699: static parser successfully parsed marts/trip_summary_per_hour.sql
[0m09:00:38.875083 [debug] [MainThread]: 1699: static parser successfully parsed staging/source_dim_weather.sql
[0m09:00:38.880938 [debug] [MainThread]: 1699: static parser successfully parsed staging/source_fact_taxi_trips.sql
[0m09:00:38.980624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1a76b8b4-382c-45d8-979a-3f4d55dc75f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5dc08a2f40>]}
[0m09:00:39.004744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1a76b8b4-382c-45d8-979a-3f4d55dc75f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5dc08dc550>]}
[0m09:00:39.006221 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 289 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m09:00:39.007862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1a76b8b4-382c-45d8-979a-3f4d55dc75f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5dc0912df0>]}
[0m09:00:39.011276 [info ] [MainThread]: 
[0m09:00:39.013729 [debug] [MainThread]: Acquiring new postgres connection "master"
[0m09:00:39.018567 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db"
[0m09:00:39.038784 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db"
[0m09:00:39.040021 [debug] [ThreadPool]: On list_nyc_taxi_db: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db"} */

    select distinct nspname from pg_namespace
  
[0m09:00:39.041046 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:00:39.064740 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.02 seconds
[0m09:00:39.067738 [debug] [ThreadPool]: On list_nyc_taxi_db: Close
[0m09:00:39.071247 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db_public"
[0m09:00:39.082406 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m09:00:39.083513 [debug] [ThreadPool]: On list_nyc_taxi_db_public: BEGIN
[0m09:00:39.084396 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:00:39.093929 [debug] [ThreadPool]: SQL status: BEGIN in 0.01 seconds
[0m09:00:39.095134 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m09:00:39.096178 [debug] [ThreadPool]: On list_nyc_taxi_db_public: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db_public"} */
select
      'nyc_taxi_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'nyc_taxi_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
[0m09:00:39.106841 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.01 seconds
[0m09:00:39.110278 [debug] [ThreadPool]: On list_nyc_taxi_db_public: ROLLBACK
[0m09:00:39.111587 [debug] [ThreadPool]: On list_nyc_taxi_db_public: Close
[0m09:00:39.119549 [debug] [MainThread]: Using postgres connection "master"
[0m09:00:39.120744 [debug] [MainThread]: On master: BEGIN
[0m09:00:39.121867 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:00:39.130730 [debug] [MainThread]: SQL status: BEGIN in 0.01 seconds
[0m09:00:39.131774 [debug] [MainThread]: Using postgres connection "master"
[0m09:00:39.132725 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:00:39.153990 [debug] [MainThread]: SQL status: SELECT 2 in 0.02 seconds
[0m09:00:39.156881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1a76b8b4-382c-45d8-979a-3f4d55dc75f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5dc2cde220>]}
[0m09:00:39.158000 [debug] [MainThread]: On master: ROLLBACK
[0m09:00:39.159046 [debug] [MainThread]: Using postgres connection "master"
[0m09:00:39.160110 [debug] [MainThread]: On master: BEGIN
[0m09:00:39.161283 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m09:00:39.161919 [debug] [MainThread]: On master: COMMIT
[0m09:00:39.162574 [debug] [MainThread]: Using postgres connection "master"
[0m09:00:39.163233 [debug] [MainThread]: On master: COMMIT
[0m09:00:39.164088 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m09:00:39.164816 [debug] [MainThread]: On master: Close
[0m09:00:39.166091 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m09:00:39.167033 [info ] [MainThread]: 
[0m09:00:39.175243 [debug] [Thread-1  ]: Began running node model.nyc_taxi.source_dim_weather
[0m09:00:39.175485 [debug] [Thread-2  ]: Began running node model.nyc_taxi.source_fact_taxi_trips
[0m09:00:39.176386 [info ] [Thread-1  ]: 1 of 5 START sql view model public.source_dim_weather .......................... [RUN]
[0m09:00:39.177784 [info ] [Thread-2  ]: 2 of 5 START sql view model public.source_fact_taxi_trips ...................... [RUN]
[0m09:00:39.179372 [debug] [Thread-1  ]: Acquiring new postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:00:39.180772 [debug] [Thread-2  ]: Acquiring new postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:00:39.181450 [debug] [Thread-1  ]: Began compiling node model.nyc_taxi.source_dim_weather
[0m09:00:39.182247 [debug] [Thread-2  ]: Began compiling node model.nyc_taxi.source_fact_taxi_trips
[0m09:00:39.183026 [debug] [Thread-1  ]: Compiling model.nyc_taxi.source_dim_weather
[0m09:00:39.184038 [debug] [Thread-2  ]: Compiling model.nyc_taxi.source_fact_taxi_trips
[0m09:00:39.190683 [debug] [Thread-1  ]: Writing injected SQL for node "model.nyc_taxi.source_dim_weather"
[0m09:00:39.195308 [debug] [Thread-2  ]: Writing injected SQL for node "model.nyc_taxi.source_fact_taxi_trips"
[0m09:00:39.202384 [debug] [Thread-1  ]: finished collecting timing info
[0m09:00:39.204019 [debug] [Thread-1  ]: Began executing node model.nyc_taxi.source_dim_weather
[0m09:00:39.204353 [debug] [Thread-2  ]: finished collecting timing info
[0m09:00:39.228109 [debug] [Thread-2  ]: Began executing node model.nyc_taxi.source_fact_taxi_trips
[0m09:00:39.284320 [debug] [Thread-1  ]: Writing runtime sql for node "model.nyc_taxi.source_dim_weather"
[0m09:00:39.286087 [debug] [Thread-2  ]: Writing runtime sql for node "model.nyc_taxi.source_fact_taxi_trips"
[0m09:00:39.294723 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:00:39.296062 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:00:39.296922 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: BEGIN
[0m09:00:39.298556 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: BEGIN
[0m09:00:39.299442 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:00:39.300518 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:00:39.309637 [debug] [Thread-1  ]: SQL status: BEGIN in 0.01 seconds
[0m09:00:39.309924 [debug] [Thread-2  ]: SQL status: BEGIN in 0.01 seconds
[0m09:00:39.310969 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:00:39.312059 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:00:39.313270 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */

  create view "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" as (
    

SELECT
    timestamp,
    temperature,
    humidity,
    wind_speed,
    weather_condition,
    weather_description,
    weather_category,
    hour_of_day,
    day_of_week
FROM
    "nyc_taxi_db"."public"."dim_weather"
  );
[0m09:00:39.314494 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */

  create view "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" as (
    

-- Échantillonnage stratifié pour conserver la représentativité
WITH taxi_sample AS (
    SELECT 
        *,
        -- Utiliser NTILE pour créer des groupes stratifiés par heure et jour
        NTILE(1000) OVER (
            PARTITION BY pickup_hour, pickup_day_of_week 
            ORDER BY pickup_datetime
        ) as sample_group
    FROM "nyc_taxi_db"."public"."fact_taxi_trips"
    WHERE 
        -- Filtrer sur une période spécifique pour réduire encore plus si nécessaire
        pickup_datetime >= '2022-01-01'
        AND pickup_datetime < '2022-04-01'  -- 3 mois au lieu de 2 ans
),

-- Prendre seulement les 3 premiers groupes de chaque strate (≈ 0.3% des données)
representative_sample AS (
    SELECT 
        pickup_datetime,
        dropoff_datetime,
        trip_duration_minutes,
        distance_km,
        distance_bucket,
        fare_amount,
        tip_amount,
        tip_percentage,
        payment_type,
        pickup_hour,
        pickup_day_of_week,
        passenger_count,
        pickup_location_id,
        dropoff_location_id
    FROM taxi_sample
    WHERE sample_group <= 3  -- Prendre seulement les 3 premiers groupes
)

SELECT * FROM representative_sample
  );
[0m09:00:39.329208 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.01 seconds
[0m09:00:39.338841 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.02 seconds
[0m09:00:39.339457 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:00:39.343817 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:00:39.344740 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
alter table "nyc_taxi_db"."public"."source_dim_weather" rename to "source_dim_weather__dbt_backup"
[0m09:00:39.345577 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
alter table "nyc_taxi_db"."public"."source_fact_taxi_trips" rename to "source_fact_taxi_trips__dbt_backup"
[0m09:00:39.348177 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:00:39.348365 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:00:39.352376 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:00:39.356359 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:00:39.357485 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
alter table "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" rename to "source_dim_weather"
[0m09:00:39.358616 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
alter table "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" rename to "source_fact_taxi_trips"
[0m09:00:39.360364 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:00:39.361585 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:00:39.395400 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m09:00:39.397830 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m09:00:39.398559 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:00:39.399698 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:00:39.400718 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m09:00:39.401664 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m09:00:39.404739 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m09:00:39.405594 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m09:00:39.412484 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:00:39.415396 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:00:39.416323 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
drop view if exists "nyc_taxi_db"."public"."source_dim_weather__dbt_backup" cascade
[0m09:00:39.417608 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
drop view if exists "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_backup" cascade
[0m09:00:39.424630 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.01 seconds
[0m09:00:39.425337 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.01 seconds
[0m09:00:39.427361 [debug] [Thread-1  ]: finished collecting timing info
[0m09:00:39.429538 [debug] [Thread-2  ]: finished collecting timing info
[0m09:00:39.430474 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: Close
[0m09:00:39.431445 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: Close
[0m09:00:39.433381 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a76b8b4-382c-45d8-979a-3f4d55dc75f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5dc05fe790>]}
[0m09:00:39.434827 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a76b8b4-382c-45d8-979a-3f4d55dc75f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5dc0581eb0>]}
[0m09:00:39.435830 [info ] [Thread-1  ]: 1 of 5 OK created sql view model public.source_dim_weather ..................... [[32mCREATE VIEW[0m in 0.25s]
[0m09:00:39.437114 [info ] [Thread-2  ]: 2 of 5 OK created sql view model public.source_fact_taxi_trips ................. [[32mCREATE VIEW[0m in 0.25s]
[0m09:00:39.438480 [debug] [Thread-1  ]: Finished running node model.nyc_taxi.source_dim_weather
[0m09:00:39.439596 [debug] [Thread-2  ]: Finished running node model.nyc_taxi.source_fact_taxi_trips
[0m09:00:39.442481 [debug] [Thread-4  ]: Began running node model.nyc_taxi.trip_enriched
[0m09:00:39.443561 [info ] [Thread-4  ]: 3 of 5 START sql table model public.trip_enriched .............................. [RUN]
[0m09:00:39.444912 [debug] [Thread-4  ]: Acquiring new postgres connection "model.nyc_taxi.trip_enriched"
[0m09:00:39.445629 [debug] [Thread-4  ]: Began compiling node model.nyc_taxi.trip_enriched
[0m09:00:39.446302 [debug] [Thread-4  ]: Compiling model.nyc_taxi.trip_enriched
[0m09:00:39.452239 [debug] [Thread-4  ]: Writing injected SQL for node "model.nyc_taxi.trip_enriched"
[0m09:00:39.459959 [debug] [Thread-4  ]: finished collecting timing info
[0m09:00:39.460794 [debug] [Thread-4  ]: Began executing node model.nyc_taxi.trip_enriched
[0m09:00:39.497470 [debug] [Thread-4  ]: Writing runtime sql for node "model.nyc_taxi.trip_enriched"
[0m09:00:39.504799 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m09:00:39.505788 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: BEGIN
[0m09:00:39.506703 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:00:39.513780 [debug] [Thread-4  ]: SQL status: BEGIN in 0.01 seconds
[0m09:00:39.514984 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m09:00:39.515995 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */

  
    

  create  table "nyc_taxi_db"."public"."trip_enriched__dbt_tmp"
  as (
    

WITH taxi_trips AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_fact_taxi_trips"
),

weather AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_dim_weather"
),

-- Créer une jointure plus flexible basée sur la date/heure
weather_hourly AS (
    SELECT 
        DATE_TRUNC('hour', timestamp) as weather_hour,
        AVG(temperature) as avg_temperature,
        AVG(humidity) as avg_humidity,
        AVG(wind_speed) as avg_wind_speed,
        -- Prendre la condition météo la plus fréquente dans l'heure
        MODE() WITHIN GROUP (ORDER BY weather_condition) as weather_condition,
        MODE() WITHIN GROUP (ORDER BY weather_category) as weather_category,
        EXTRACT(HOUR FROM timestamp) as hour_of_day,
        EXTRACT(DOW FROM timestamp) as day_of_week
    FROM weather
    GROUP BY DATE_TRUNC('hour', timestamp), EXTRACT(HOUR FROM timestamp), EXTRACT(DOW FROM timestamp)
)

SELECT
    t.pickup_datetime,
    t.dropoff_datetime,
    t.trip_duration_minutes,
    t.distance_km,
    t.distance_bucket,
    t.fare_amount,
    t.tip_amount,
    t.tip_percentage,
    t.payment_type,
    t.pickup_hour,
    t.pickup_day_of_week,
    t.passenger_count,
    t.pickup_location_id,
    t.dropoff_location_id,
    
    -- Données météo jointuréés
    w.avg_temperature as temperature,
    w.avg_humidity as humidity,
    w.avg_wind_speed as wind_speed,
    w.weather_condition,
    w.weather_category
FROM
    taxi_trips t
LEFT JOIN
    weather_hourly w
    -- Jointure sur l'heure arrondie
    ON DATE_TRUNC('hour', t.pickup_datetime) = w.weather_hour
  );
  
[0m09:00:39.520564 [debug] [Thread-4  ]: Postgres adapter: Postgres error: function date_trunc(unknown, text) does not exist
LINE 23:         DATE_TRUNC('hour', timestamp) as weather_hour,
                 ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m09:00:39.521875 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: ROLLBACK
[0m09:00:39.523317 [debug] [Thread-4  ]: finished collecting timing info
[0m09:00:39.524286 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: Close
[0m09:00:39.525688 [debug] [Thread-4  ]: Database Error in model trip_enriched (models/intermediate/trip_enriched.sql)
  function date_trunc(unknown, text) does not exist
  LINE 23:         DATE_TRUNC('hour', timestamp) as weather_hour,
                   ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/nyc_taxi/models/intermediate/trip_enriched.sql
[0m09:00:39.526750 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a76b8b4-382c-45d8-979a-3f4d55dc75f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5dc0522ee0>]}
[0m09:00:39.528093 [error] [Thread-4  ]: 3 of 5 ERROR creating sql table model public.trip_enriched ..................... [[31mERROR[0m in 0.08s]
[0m09:00:39.529311 [debug] [Thread-4  ]: Finished running node model.nyc_taxi.trip_enriched
[0m09:00:39.531303 [debug] [Thread-1  ]: Began running node model.nyc_taxi.high_value_customers
[0m09:00:39.531809 [debug] [Thread-2  ]: Began running node model.nyc_taxi.trip_summary_per_hour
[0m09:00:39.532589 [info ] [Thread-1  ]: 4 of 5 SKIP relation public.high_value_customers ............................... [[33mSKIP[0m]
[0m09:00:39.533608 [info ] [Thread-2  ]: 5 of 5 SKIP relation public.trip_summary_per_hour .............................. [[33mSKIP[0m]
[0m09:00:39.534819 [debug] [Thread-1  ]: Finished running node model.nyc_taxi.high_value_customers
[0m09:00:39.535816 [debug] [Thread-2  ]: Finished running node model.nyc_taxi.trip_summary_per_hour
[0m09:00:39.540200 [debug] [MainThread]: Acquiring new postgres connection "master"
[0m09:00:39.541256 [debug] [MainThread]: Using postgres connection "master"
[0m09:00:39.542089 [debug] [MainThread]: On master: BEGIN
[0m09:00:39.542911 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:00:39.549597 [debug] [MainThread]: SQL status: BEGIN in 0.01 seconds
[0m09:00:39.550579 [debug] [MainThread]: On master: COMMIT
[0m09:00:39.551395 [debug] [MainThread]: Using postgres connection "master"
[0m09:00:39.552187 [debug] [MainThread]: On master: COMMIT
[0m09:00:39.553119 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m09:00:39.553954 [debug] [MainThread]: On master: Close
[0m09:00:39.555600 [info ] [MainThread]: 
[0m09:00:39.556735 [info ] [MainThread]: Finished running 2 view models, 3 table models in 0 hours 0 minutes and 0.54 seconds (0.54s).
[0m09:00:39.558680 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:00:39.559957 [debug] [MainThread]: Connection 'model.nyc_taxi.source_dim_weather' was properly closed.
[0m09:00:39.560914 [debug] [MainThread]: Connection 'model.nyc_taxi.source_fact_taxi_trips' was properly closed.
[0m09:00:39.561689 [debug] [MainThread]: Connection 'model.nyc_taxi.trip_enriched' was properly closed.
[0m09:00:39.579359 [info ] [MainThread]: 
[0m09:00:39.580578 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:00:39.581796 [info ] [MainThread]: 
[0m09:00:39.582899 [error] [MainThread]: [33mDatabase Error in model trip_enriched (models/intermediate/trip_enriched.sql)[0m
[0m09:00:39.584140 [error] [MainThread]:   function date_trunc(unknown, text) does not exist
[0m09:00:39.585195 [error] [MainThread]:   LINE 23:         DATE_TRUNC('hour', timestamp) as weather_hour,
[0m09:00:39.586229 [error] [MainThread]:                    ^
[0m09:00:39.587357 [error] [MainThread]:   HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
[0m09:00:39.588685 [error] [MainThread]:   compiled Code at target/run/nyc_taxi/models/intermediate/trip_enriched.sql
[0m09:00:39.590269 [info ] [MainThread]: 
[0m09:00:39.591649 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=2 TOTAL=5
[0m09:00:39.592962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5dc05349a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5dc0534700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5dc0581250>]}
[0m09:00:39.594201 [debug] [MainThread]: Flushing usage events


============================== 2025-05-22 09:03:56.776274 | d9edc3c5-3e14-4c90-8937-c536d218ac55 ==============================
[0m09:03:56.776315 [info ] [MainThread]: Running with dbt=1.3.0
[0m09:03:56.778096 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/usr/app/dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m09:03:56.779572 [debug] [MainThread]: Tracking: tracking
[0m09:03:56.785499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faee2750820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faee2750730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faee2750790>]}
[0m09:03:57.025663 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:03:57.027587 [debug] [MainThread]: Partial parsing: updated file: nyc_taxi://models/intermediate/trip_enriched.sql
[0m09:03:57.051975 [debug] [MainThread]: 1699: static parser successfully parsed intermediate/trip_enriched.sql
[0m09:03:57.161998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd9edc3c5-3e14-4c90-8937-c536d218ac55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faee305cf70>]}
[0m09:03:57.186471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd9edc3c5-3e14-4c90-8937-c536d218ac55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faee2375c10>]}
[0m09:03:57.188165 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 289 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m09:03:57.190470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd9edc3c5-3e14-4c90-8937-c536d218ac55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faee2359d90>]}
[0m09:03:57.195622 [info ] [MainThread]: 
[0m09:03:57.198309 [debug] [MainThread]: Acquiring new postgres connection "master"
[0m09:03:57.201400 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db"
[0m09:03:57.224598 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db"
[0m09:03:57.226197 [debug] [ThreadPool]: On list_nyc_taxi_db: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db"} */

    select distinct nspname from pg_namespace
  
[0m09:03:57.227303 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:03:57.243214 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.02 seconds
[0m09:03:57.245778 [debug] [ThreadPool]: On list_nyc_taxi_db: Close
[0m09:03:57.249373 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db_public"
[0m09:03:57.259523 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m09:03:57.260779 [debug] [ThreadPool]: On list_nyc_taxi_db_public: BEGIN
[0m09:03:57.261728 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:03:57.269822 [debug] [ThreadPool]: SQL status: BEGIN in 0.01 seconds
[0m09:03:57.270972 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m09:03:57.271938 [debug] [ThreadPool]: On list_nyc_taxi_db_public: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db_public"} */
select
      'nyc_taxi_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'nyc_taxi_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
[0m09:03:57.275763 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.0 seconds
[0m09:03:57.278698 [debug] [ThreadPool]: On list_nyc_taxi_db_public: ROLLBACK
[0m09:03:57.279941 [debug] [ThreadPool]: On list_nyc_taxi_db_public: Close
[0m09:03:57.288402 [debug] [MainThread]: Using postgres connection "master"
[0m09:03:57.289433 [debug] [MainThread]: On master: BEGIN
[0m09:03:57.290321 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:03:57.298272 [debug] [MainThread]: SQL status: BEGIN in 0.01 seconds
[0m09:03:57.299515 [debug] [MainThread]: Using postgres connection "master"
[0m09:03:57.300443 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:03:57.320646 [debug] [MainThread]: SQL status: SELECT 2 in 0.02 seconds
[0m09:03:57.323392 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd9edc3c5-3e14-4c90-8937-c536d218ac55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faee4ddbc10>]}
[0m09:03:57.324574 [debug] [MainThread]: On master: ROLLBACK
[0m09:03:57.325875 [debug] [MainThread]: Using postgres connection "master"
[0m09:03:57.326940 [debug] [MainThread]: On master: BEGIN
[0m09:03:57.328453 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m09:03:57.329398 [debug] [MainThread]: On master: COMMIT
[0m09:03:57.330363 [debug] [MainThread]: Using postgres connection "master"
[0m09:03:57.331228 [debug] [MainThread]: On master: COMMIT
[0m09:03:57.332340 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m09:03:57.333193 [debug] [MainThread]: On master: Close
[0m09:03:57.334652 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m09:03:57.335668 [info ] [MainThread]: 
[0m09:03:57.364523 [debug] [Thread-1  ]: Began running node model.nyc_taxi.source_dim_weather
[0m09:03:57.364892 [debug] [Thread-2  ]: Began running node model.nyc_taxi.source_fact_taxi_trips
[0m09:03:57.365978 [info ] [Thread-1  ]: 1 of 5 START sql view model public.source_dim_weather .......................... [RUN]
[0m09:03:57.367422 [info ] [Thread-2  ]: 2 of 5 START sql view model public.source_fact_taxi_trips ...................... [RUN]
[0m09:03:57.369626 [debug] [Thread-1  ]: Acquiring new postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:03:57.371559 [debug] [Thread-2  ]: Acquiring new postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:03:57.372518 [debug] [Thread-1  ]: Began compiling node model.nyc_taxi.source_dim_weather
[0m09:03:57.373764 [debug] [Thread-2  ]: Began compiling node model.nyc_taxi.source_fact_taxi_trips
[0m09:03:57.375456 [debug] [Thread-1  ]: Compiling model.nyc_taxi.source_dim_weather
[0m09:03:57.377317 [debug] [Thread-2  ]: Compiling model.nyc_taxi.source_fact_taxi_trips
[0m09:03:57.384721 [debug] [Thread-1  ]: Writing injected SQL for node "model.nyc_taxi.source_dim_weather"
[0m09:03:57.391681 [debug] [Thread-2  ]: Writing injected SQL for node "model.nyc_taxi.source_fact_taxi_trips"
[0m09:03:57.398986 [debug] [Thread-1  ]: finished collecting timing info
[0m09:03:57.400470 [debug] [Thread-2  ]: finished collecting timing info
[0m09:03:57.400933 [debug] [Thread-1  ]: Began executing node model.nyc_taxi.source_dim_weather
[0m09:03:57.402351 [debug] [Thread-2  ]: Began executing node model.nyc_taxi.source_fact_taxi_trips
[0m09:03:57.501308 [debug] [Thread-1  ]: Writing runtime sql for node "model.nyc_taxi.source_dim_weather"
[0m09:03:57.504140 [debug] [Thread-2  ]: Writing runtime sql for node "model.nyc_taxi.source_fact_taxi_trips"
[0m09:03:57.513289 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:03:57.514747 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:03:57.515644 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: BEGIN
[0m09:03:57.516908 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: BEGIN
[0m09:03:57.518042 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:03:57.519135 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:03:57.526876 [debug] [Thread-2  ]: SQL status: BEGIN in 0.01 seconds
[0m09:03:57.527250 [debug] [Thread-1  ]: SQL status: BEGIN in 0.01 seconds
[0m09:03:57.528200 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:03:57.529487 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:03:57.530907 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */

  create view "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" as (
    

-- Échantillonnage stratifié pour conserver la représentativité
WITH taxi_sample AS (
    SELECT 
        *,
        -- Utiliser NTILE pour créer des groupes stratifiés par heure et jour
        NTILE(1000) OVER (
            PARTITION BY pickup_hour, pickup_day_of_week 
            ORDER BY pickup_datetime
        ) as sample_group
    FROM "nyc_taxi_db"."public"."fact_taxi_trips"
    WHERE 
        -- Filtrer sur une période spécifique pour réduire encore plus si nécessaire
        pickup_datetime >= '2022-01-01'
        AND pickup_datetime < '2022-04-01'  -- 3 mois au lieu de 2 ans
),

-- Prendre seulement les 3 premiers groupes de chaque strate (≈ 0.3% des données)
representative_sample AS (
    SELECT 
        pickup_datetime,
        dropoff_datetime,
        trip_duration_minutes,
        distance_km,
        distance_bucket,
        fare_amount,
        tip_amount,
        tip_percentage,
        payment_type,
        pickup_hour,
        pickup_day_of_week,
        passenger_count,
        pickup_location_id,
        dropoff_location_id
    FROM taxi_sample
    WHERE sample_group <= 3  -- Prendre seulement les 3 premiers groupes
)

SELECT * FROM representative_sample
  );
[0m09:03:57.532294 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */

  create view "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" as (
    

SELECT
    timestamp,
    temperature,
    humidity,
    wind_speed,
    weather_condition,
    weather_description,
    weather_category,
    hour_of_day,
    day_of_week
FROM
    "nyc_taxi_db"."public"."dim_weather"
  );
[0m09:03:57.537912 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m09:03:57.544706 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.01 seconds
[0m09:03:57.550353 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:03:57.555986 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:03:57.557217 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
alter table "nyc_taxi_db"."public"."source_dim_weather" rename to "source_dim_weather__dbt_backup"
[0m09:03:57.558523 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
alter table "nyc_taxi_db"."public"."source_fact_taxi_trips" rename to "source_fact_taxi_trips__dbt_backup"
[0m09:03:57.560559 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:03:57.561527 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:03:57.565788 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:03:57.570497 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:03:57.571594 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
alter table "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" rename to "source_dim_weather"
[0m09:03:57.572576 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
alter table "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" rename to "source_fact_taxi_trips"
[0m09:03:57.574247 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:03:57.575194 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:03:57.619907 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m09:03:57.622570 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m09:03:57.623914 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:03:57.625773 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:03:57.626766 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m09:03:57.627789 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m09:03:57.630427 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m09:03:57.631480 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m09:03:57.639269 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:03:57.642777 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:03:57.643915 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
drop view if exists "nyc_taxi_db"."public"."source_dim_weather__dbt_backup" cascade
[0m09:03:57.644865 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
drop view if exists "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_backup" cascade
[0m09:03:57.648785 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m09:03:57.649815 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.0 seconds
[0m09:03:57.651855 [debug] [Thread-1  ]: finished collecting timing info
[0m09:03:57.654267 [debug] [Thread-2  ]: finished collecting timing info
[0m09:03:57.655329 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: Close
[0m09:03:57.656409 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: Close
[0m09:03:57.658511 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9edc3c5-3e14-4c90-8937-c536d218ac55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faee22ba430>]}
[0m09:03:57.660260 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9edc3c5-3e14-4c90-8937-c536d218ac55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faee2281ca0>]}
[0m09:03:57.661306 [info ] [Thread-1  ]: 1 of 5 OK created sql view model public.source_dim_weather ..................... [[32mCREATE VIEW[0m in 0.29s]
[0m09:03:57.662794 [info ] [Thread-2  ]: 2 of 5 OK created sql view model public.source_fact_taxi_trips ................. [[32mCREATE VIEW[0m in 0.29s]
[0m09:03:57.664409 [debug] [Thread-1  ]: Finished running node model.nyc_taxi.source_dim_weather
[0m09:03:57.665611 [debug] [Thread-2  ]: Finished running node model.nyc_taxi.source_fact_taxi_trips
[0m09:03:57.669328 [debug] [Thread-4  ]: Began running node model.nyc_taxi.trip_enriched
[0m09:03:57.670695 [info ] [Thread-4  ]: 3 of 5 START sql table model public.trip_enriched .............................. [RUN]
[0m09:03:57.672827 [debug] [Thread-4  ]: Acquiring new postgres connection "model.nyc_taxi.trip_enriched"
[0m09:03:57.673870 [debug] [Thread-4  ]: Began compiling node model.nyc_taxi.trip_enriched
[0m09:03:57.675035 [debug] [Thread-4  ]: Compiling model.nyc_taxi.trip_enriched
[0m09:03:57.683961 [debug] [Thread-4  ]: Writing injected SQL for node "model.nyc_taxi.trip_enriched"
[0m09:03:57.692405 [debug] [Thread-4  ]: finished collecting timing info
[0m09:03:57.693758 [debug] [Thread-4  ]: Began executing node model.nyc_taxi.trip_enriched
[0m09:03:57.746777 [debug] [Thread-4  ]: Writing runtime sql for node "model.nyc_taxi.trip_enriched"
[0m09:03:57.760003 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m09:03:57.761289 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: BEGIN
[0m09:03:57.762419 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:03:57.771782 [debug] [Thread-4  ]: SQL status: BEGIN in 0.01 seconds
[0m09:03:57.773030 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m09:03:57.774132 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */

  
    

  create  table "nyc_taxi_db"."public"."trip_enriched__dbt_tmp"
  as (
    

WITH taxi_trips AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_fact_taxi_trips"
),

weather AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_dim_weather"
),

-- Créer une jointure simple basée sur l'heure et le jour
weather_simplified AS (
    SELECT 
        hour_of_day,
        day_of_week,
        AVG(temperature) as avg_temperature,
        AVG(humidity) as avg_humidity,
        AVG(wind_speed) as avg_wind_speed,
        -- Utiliser la première valeur non-null pour les catégories
        MIN(weather_condition) as weather_condition,
        MIN(weather_category) as weather_category
    FROM weather
    WHERE temperature IS NOT NULL 
      AND hour_of_day IS NOT NULL 
      AND day_of_week IS NOT NULL
    GROUP BY hour_of_day, day_of_week
)

SELECT
    t.pickup_datetime,
    t.dropoff_datetime,
    t.trip_duration_minutes,
    t.distance_km,
    t.distance_bucket,
    t.fare_amount,
    t.tip_amount,
    t.tip_percentage,
    t.payment_type,
    t.pickup_hour,
    t.pickup_day_of_week,
    t.passenger_count,
    t.pickup_location_id,
    t.dropoff_location_id,
    
    -- Données météo jointées
    w.avg_temperature as temperature,
    w.avg_humidity as humidity,
    w.avg_wind_speed as wind_speed,
    w.weather_condition,
    w.weather_category
FROM
    taxi_trips t
LEFT JOIN
    weather_simplified w
    -- Jointure simple sur heure et jour de la semaine
    ON t.pickup_hour = w.hour_of_day 
    AND t.pickup_day_of_week = w.day_of_week
  );
  
[0m09:03:57.797685 [debug] [Thread-4  ]: SQL status: SELECT 0 in 0.02 seconds
[0m09:03:57.803271 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m09:03:57.804369 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */
alter table "nyc_taxi_db"."public"."trip_enriched" rename to "trip_enriched__dbt_backup"
[0m09:03:57.806177 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:03:57.813331 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m09:03:57.815023 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */
alter table "nyc_taxi_db"."public"."trip_enriched__dbt_tmp" rename to "trip_enriched"
[0m09:03:57.816469 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:03:57.829282 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: COMMIT
[0m09:03:57.830670 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m09:03:57.832022 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: COMMIT
[0m09:03:57.834610 [debug] [Thread-4  ]: SQL status: COMMIT in 0.0 seconds
[0m09:03:57.839711 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m09:03:57.840772 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */
drop table if exists "nyc_taxi_db"."public"."trip_enriched__dbt_backup" cascade
[0m09:03:57.850844 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.01 seconds
[0m09:03:57.853246 [debug] [Thread-4  ]: finished collecting timing info
[0m09:03:57.854285 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: Close
[0m09:03:57.855939 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9edc3c5-3e14-4c90-8937-c536d218ac55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faee1f59c40>]}
[0m09:03:57.857147 [info ] [Thread-4  ]: 3 of 5 OK created sql table model public.trip_enriched ......................... [[32mSELECT 0[0m in 0.18s]
[0m09:03:57.858593 [debug] [Thread-4  ]: Finished running node model.nyc_taxi.trip_enriched
[0m09:03:57.860785 [debug] [Thread-1  ]: Began running node model.nyc_taxi.high_value_customers
[0m09:03:57.861051 [debug] [Thread-2  ]: Began running node model.nyc_taxi.trip_summary_per_hour
[0m09:03:57.862033 [info ] [Thread-1  ]: 4 of 5 START sql table model public.high_value_customers ....................... [RUN]
[0m09:03:57.863122 [info ] [Thread-2  ]: 5 of 5 START sql table model public.trip_summary_per_hour ...................... [RUN]
[0m09:03:57.864921 [debug] [Thread-1  ]: Acquiring new postgres connection "model.nyc_taxi.high_value_customers"
[0m09:03:57.866423 [debug] [Thread-2  ]: Acquiring new postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m09:03:57.867033 [debug] [Thread-1  ]: Began compiling node model.nyc_taxi.high_value_customers
[0m09:03:57.868135 [debug] [Thread-2  ]: Began compiling node model.nyc_taxi.trip_summary_per_hour
[0m09:03:57.869083 [debug] [Thread-1  ]: Compiling model.nyc_taxi.high_value_customers
[0m09:03:57.870092 [debug] [Thread-2  ]: Compiling model.nyc_taxi.trip_summary_per_hour
[0m09:03:57.875552 [debug] [Thread-1  ]: Writing injected SQL for node "model.nyc_taxi.high_value_customers"
[0m09:03:57.881340 [debug] [Thread-2  ]: Writing injected SQL for node "model.nyc_taxi.trip_summary_per_hour"
[0m09:03:57.889721 [debug] [Thread-1  ]: finished collecting timing info
[0m09:03:57.891562 [debug] [Thread-1  ]: Began executing node model.nyc_taxi.high_value_customers
[0m09:03:57.892605 [debug] [Thread-2  ]: finished collecting timing info
[0m09:03:57.901529 [debug] [Thread-1  ]: Writing runtime sql for node "model.nyc_taxi.high_value_customers"
[0m09:03:57.902561 [debug] [Thread-2  ]: Began executing node model.nyc_taxi.trip_summary_per_hour
[0m09:03:57.915803 [debug] [Thread-2  ]: Writing runtime sql for node "model.nyc_taxi.trip_summary_per_hour"
[0m09:03:57.919398 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m09:03:57.920825 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: BEGIN
[0m09:03:57.922980 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:03:57.925027 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m09:03:57.926291 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: BEGIN
[0m09:03:57.927547 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m09:03:57.934314 [debug] [Thread-1  ]: SQL status: BEGIN in 0.01 seconds
[0m09:03:57.935805 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m09:03:57.937204 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.high_value_customers"} */

  
    

  create  table "nyc_taxi_db"."public"."high_value_customers__dbt_tmp"
  as (
    

WITH trip_data AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."trip_enriched"
),

customer_stats AS (
    SELECT
        -- Using passenger_count as a proxy for customer identification
        -- In a real scenario, you might have a proper customer ID
        passenger_count,
        pickup_location_id,
        COUNT(*) AS num_trips,
        SUM(fare_amount + tip_amount) AS total_spent,
        AVG(tip_percentage) AS avg_tip_percentage
    FROM
        trip_data
    WHERE
        passenger_count > 0
    GROUP BY
        passenger_count,
        pickup_location_id
)

SELECT
    passenger_count,
    pickup_location_id,
    num_trips,
    total_spent,
    avg_tip_percentage
FROM
    customer_stats
WHERE
    num_trips > 10
    AND total_spent > 300
    AND avg_tip_percentage > 15
  );
  
[0m09:03:57.938934 [debug] [Thread-2  ]: SQL status: BEGIN in 0.01 seconds
[0m09:03:57.939908 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m09:03:57.941075 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */

  
    

  create  table "nyc_taxi_db"."public"."trip_summary_per_hour__dbt_tmp"
  as (
    

WITH trip_data AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."trip_enriched"
)

SELECT
    pickup_hour,
    weather_category,
    COUNT(*) AS num_trips,
    AVG(trip_duration_minutes) AS avg_trip_duration,
    AVG(tip_percentage) AS avg_tip_percentage,
    AVG(fare_amount) AS avg_fare_amount,
    AVG(distance_km) AS avg_distance
FROM
    trip_data
GROUP BY
    pickup_hour,
    weather_category
  );
  
[0m09:03:57.943410 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.0 seconds
[0m09:03:57.949346 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m09:03:57.949882 [debug] [Thread-2  ]: SQL status: SELECT 0 in 0.01 seconds
[0m09:03:57.950584 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.high_value_customers"} */
alter table "nyc_taxi_db"."public"."high_value_customers" rename to "high_value_customers__dbt_backup"
[0m09:03:57.955900 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m09:03:57.958142 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */
alter table "nyc_taxi_db"."public"."trip_summary_per_hour" rename to "trip_summary_per_hour__dbt_backup"
[0m09:03:57.958362 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:03:57.959776 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:03:57.964026 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m09:03:57.968698 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m09:03:57.969852 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.high_value_customers"} */
alter table "nyc_taxi_db"."public"."high_value_customers__dbt_tmp" rename to "high_value_customers"
[0m09:03:57.970842 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */
alter table "nyc_taxi_db"."public"."trip_summary_per_hour__dbt_tmp" rename to "trip_summary_per_hour"
[0m09:03:57.974442 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:03:57.975428 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:03:57.980735 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m09:03:57.986012 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m09:03:57.988003 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.high_value_customers"} */

        CREATE INDEX IF NOT EXISTS idx_high_value_customers_pickup_datetime ON "nyc_taxi_db"."public"."high_value_customers" (pickup_datetime)
      
[0m09:03:57.990135 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */

        CREATE INDEX IF NOT EXISTS idx_trip_summary_per_hour_pickup_datetime ON "nyc_taxi_db"."public"."trip_summary_per_hour" (pickup_datetime)
      
[0m09:03:57.993664 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "pickup_datetime" does not exist

[0m09:03:57.994480 [debug] [Thread-2  ]: Postgres adapter: Postgres error: column "pickup_datetime" does not exist

[0m09:03:57.994929 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: ROLLBACK
[0m09:03:57.995932 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: ROLLBACK
[0m09:03:57.997419 [debug] [Thread-1  ]: finished collecting timing info
[0m09:03:57.998540 [debug] [Thread-2  ]: finished collecting timing info
[0m09:03:57.999281 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: Close
[0m09:03:58.000302 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: Close
[0m09:03:58.002091 [debug] [Thread-1  ]: Database Error in model high_value_customers (models/marts/high_value_customers.sql)
  column "pickup_datetime" does not exist
  compiled Code at target/run/nyc_taxi/models/marts/high_value_customers.sql
[0m09:03:58.003557 [debug] [Thread-2  ]: Database Error in model trip_summary_per_hour (models/marts/trip_summary_per_hour.sql)
  column "pickup_datetime" does not exist
  compiled Code at target/run/nyc_taxi/models/marts/trip_summary_per_hour.sql
[0m09:03:58.004510 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9edc3c5-3e14-4c90-8937-c536d218ac55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faee22fe460>]}
[0m09:03:58.005709 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9edc3c5-3e14-4c90-8937-c536d218ac55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faee1ec7bb0>]}
[0m09:03:58.007055 [error] [Thread-1  ]: 4 of 5 ERROR creating sql table model public.high_value_customers .............. [[31mERROR[0m in 0.14s]
[0m09:03:58.008675 [error] [Thread-2  ]: 5 of 5 ERROR creating sql table model public.trip_summary_per_hour ............. [[31mERROR[0m in 0.14s]
[0m09:03:58.010202 [debug] [Thread-1  ]: Finished running node model.nyc_taxi.high_value_customers
[0m09:03:58.011553 [debug] [Thread-2  ]: Finished running node model.nyc_taxi.trip_summary_per_hour
[0m09:03:58.016157 [debug] [MainThread]: Acquiring new postgres connection "master"
[0m09:03:58.017204 [debug] [MainThread]: Using postgres connection "master"
[0m09:03:58.018141 [debug] [MainThread]: On master: BEGIN
[0m09:03:58.019043 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:03:58.026927 [debug] [MainThread]: SQL status: BEGIN in 0.01 seconds
[0m09:03:58.028169 [debug] [MainThread]: On master: COMMIT
[0m09:03:58.029260 [debug] [MainThread]: Using postgres connection "master"
[0m09:03:58.030399 [debug] [MainThread]: On master: COMMIT
[0m09:03:58.032000 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m09:03:58.033216 [debug] [MainThread]: On master: Close
[0m09:03:58.035033 [info ] [MainThread]: 
[0m09:03:58.036127 [info ] [MainThread]: Finished running 2 view models, 3 table models in 0 hours 0 minutes and 0.84 seconds (0.84s).
[0m09:03:58.037579 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:03:58.038721 [debug] [MainThread]: Connection 'model.nyc_taxi.high_value_customers' was properly closed.
[0m09:03:58.039739 [debug] [MainThread]: Connection 'model.nyc_taxi.trip_summary_per_hour' was properly closed.
[0m09:03:58.040680 [debug] [MainThread]: Connection 'model.nyc_taxi.trip_enriched' was properly closed.
[0m09:03:58.059601 [info ] [MainThread]: 
[0m09:03:58.061262 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m09:03:58.062937 [info ] [MainThread]: 
[0m09:03:58.064276 [error] [MainThread]: [33mDatabase Error in model high_value_customers (models/marts/high_value_customers.sql)[0m
[0m09:03:58.065567 [error] [MainThread]:   column "pickup_datetime" does not exist
[0m09:03:58.066833 [error] [MainThread]:   compiled Code at target/run/nyc_taxi/models/marts/high_value_customers.sql
[0m09:03:58.068377 [info ] [MainThread]: 
[0m09:03:58.069621 [error] [MainThread]: [33mDatabase Error in model trip_summary_per_hour (models/marts/trip_summary_per_hour.sql)[0m
[0m09:03:58.070953 [error] [MainThread]:   column "pickup_datetime" does not exist
[0m09:03:58.072455 [error] [MainThread]:   compiled Code at target/run/nyc_taxi/models/marts/trip_summary_per_hour.sql
[0m09:03:58.073787 [info ] [MainThread]: 
[0m09:03:58.075056 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=2 SKIP=0 TOTAL=5
[0m09:03:58.077369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faee1ec7f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faee1ec7f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faee22f55b0>]}
[0m09:03:58.079469 [debug] [MainThread]: Flushing usage events


============================== 2025-05-22 09:05:26.609747 | f2bc866d-b566-4509-9dd9-88c7772d9734 ==============================
[0m09:05:26.609790 [info ] [MainThread]: Running with dbt=1.3.0
[0m09:05:26.611434 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/usr/app/dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m09:05:26.613404 [debug] [MainThread]: Tracking: tracking
[0m09:05:26.620242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6048390280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6048390370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6048390310>]}
[0m09:05:26.907299 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:05:26.908937 [debug] [MainThread]: Partial parsing: updated file: nyc_taxi://models/marts/high_value_customers.sql
[0m09:05:26.931867 [debug] [MainThread]: 1699: static parser successfully parsed marts/high_value_customers.sql
[0m09:05:27.022919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f2bc866d-b566-4509-9dd9-88c7772d9734', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6047ed7ee0>]}
[0m09:05:27.049249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f2bc866d-b566-4509-9dd9-88c7772d9734', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6047f2ad60>]}
[0m09:05:27.050686 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 289 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m09:05:27.051923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2bc866d-b566-4509-9dd9-88c7772d9734', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6047f17b50>]}
[0m09:05:27.056904 [info ] [MainThread]: 
[0m09:05:27.059205 [debug] [MainThread]: Acquiring new postgres connection "master"
[0m09:05:27.064356 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db"
[0m09:05:27.085659 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db"
[0m09:05:27.087061 [debug] [ThreadPool]: On list_nyc_taxi_db: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db"} */

    select distinct nspname from pg_namespace
  
[0m09:05:27.088158 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:05:27.099684 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.01 seconds
[0m09:05:27.102839 [debug] [ThreadPool]: On list_nyc_taxi_db: Close
[0m09:05:27.107033 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db_public"
[0m09:05:27.118608 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m09:05:27.120331 [debug] [ThreadPool]: On list_nyc_taxi_db_public: BEGIN
[0m09:05:27.121614 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:05:27.130875 [debug] [ThreadPool]: SQL status: BEGIN in 0.01 seconds
[0m09:05:27.132028 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m09:05:27.133202 [debug] [ThreadPool]: On list_nyc_taxi_db_public: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db_public"} */
select
      'nyc_taxi_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'nyc_taxi_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
[0m09:05:27.137161 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.0 seconds
[0m09:05:27.140971 [debug] [ThreadPool]: On list_nyc_taxi_db_public: ROLLBACK
[0m09:05:27.142474 [debug] [ThreadPool]: On list_nyc_taxi_db_public: Close
[0m09:05:27.151714 [debug] [MainThread]: Using postgres connection "master"
[0m09:05:27.153449 [debug] [MainThread]: On master: BEGIN
[0m09:05:27.154490 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:05:27.163636 [debug] [MainThread]: SQL status: BEGIN in 0.01 seconds
[0m09:05:27.164982 [debug] [MainThread]: Using postgres connection "master"
[0m09:05:27.165845 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:05:27.189629 [debug] [MainThread]: SQL status: SELECT 2 in 0.02 seconds
[0m09:05:27.192238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2bc866d-b566-4509-9dd9-88c7772d9734', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6047f337c0>]}
[0m09:05:27.193636 [debug] [MainThread]: On master: ROLLBACK
[0m09:05:27.194901 [debug] [MainThread]: Using postgres connection "master"
[0m09:05:27.195698 [debug] [MainThread]: On master: BEGIN
[0m09:05:27.196811 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m09:05:27.197626 [debug] [MainThread]: On master: COMMIT
[0m09:05:27.198435 [debug] [MainThread]: Using postgres connection "master"
[0m09:05:27.199308 [debug] [MainThread]: On master: COMMIT
[0m09:05:27.200495 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m09:05:27.201385 [debug] [MainThread]: On master: Close
[0m09:05:27.202866 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m09:05:27.203920 [info ] [MainThread]: 
[0m09:05:27.211915 [debug] [Thread-1  ]: Began running node model.nyc_taxi.source_dim_weather
[0m09:05:27.212199 [debug] [Thread-2  ]: Began running node model.nyc_taxi.source_fact_taxi_trips
[0m09:05:27.213120 [info ] [Thread-1  ]: 1 of 5 START sql view model public.source_dim_weather .......................... [RUN]
[0m09:05:27.214382 [info ] [Thread-2  ]: 2 of 5 START sql view model public.source_fact_taxi_trips ...................... [RUN]
[0m09:05:27.216251 [debug] [Thread-1  ]: Acquiring new postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:05:27.217790 [debug] [Thread-2  ]: Acquiring new postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:05:27.218479 [debug] [Thread-1  ]: Began compiling node model.nyc_taxi.source_dim_weather
[0m09:05:27.219419 [debug] [Thread-2  ]: Began compiling node model.nyc_taxi.source_fact_taxi_trips
[0m09:05:27.220499 [debug] [Thread-1  ]: Compiling model.nyc_taxi.source_dim_weather
[0m09:05:27.221867 [debug] [Thread-2  ]: Compiling model.nyc_taxi.source_fact_taxi_trips
[0m09:05:27.228527 [debug] [Thread-1  ]: Writing injected SQL for node "model.nyc_taxi.source_dim_weather"
[0m09:05:27.233693 [debug] [Thread-2  ]: Writing injected SQL for node "model.nyc_taxi.source_fact_taxi_trips"
[0m09:05:27.240655 [debug] [Thread-1  ]: finished collecting timing info
[0m09:05:27.242186 [debug] [Thread-1  ]: Began executing node model.nyc_taxi.source_dim_weather
[0m09:05:27.242894 [debug] [Thread-2  ]: finished collecting timing info
[0m09:05:27.270811 [debug] [Thread-2  ]: Began executing node model.nyc_taxi.source_fact_taxi_trips
[0m09:05:27.326963 [debug] [Thread-1  ]: Writing runtime sql for node "model.nyc_taxi.source_dim_weather"
[0m09:05:27.327685 [debug] [Thread-2  ]: Writing runtime sql for node "model.nyc_taxi.source_fact_taxi_trips"
[0m09:05:27.333813 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:05:27.335170 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: BEGIN
[0m09:05:27.335554 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:05:27.336554 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:05:27.337778 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: BEGIN
[0m09:05:27.339825 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:05:27.346134 [debug] [Thread-1  ]: SQL status: BEGIN in 0.01 seconds
[0m09:05:27.347288 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:05:27.347679 [debug] [Thread-2  ]: SQL status: BEGIN in 0.01 seconds
[0m09:05:27.348376 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */

  create view "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" as (
    

SELECT
    timestamp,
    temperature,
    humidity,
    wind_speed,
    weather_condition,
    weather_description,
    weather_category,
    hour_of_day,
    day_of_week
FROM
    "nyc_taxi_db"."public"."dim_weather"
  );
[0m09:05:27.349248 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:05:27.350881 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */

  create view "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" as (
    

-- Échantillonnage stratifié pour conserver la représentativité
WITH taxi_sample AS (
    SELECT 
        *,
        -- Utiliser NTILE pour créer des groupes stratifiés par heure et jour
        NTILE(1000) OVER (
            PARTITION BY pickup_hour, pickup_day_of_week 
            ORDER BY pickup_datetime
        ) as sample_group
    FROM "nyc_taxi_db"."public"."fact_taxi_trips"
    WHERE 
        -- Filtrer sur une période spécifique pour réduire encore plus si nécessaire
        pickup_datetime >= '2022-01-01'
        AND pickup_datetime < '2022-04-01'  -- 3 mois au lieu de 2 ans
),

-- Prendre seulement les 3 premiers groupes de chaque strate (≈ 0.3% des données)
representative_sample AS (
    SELECT 
        pickup_datetime,
        dropoff_datetime,
        trip_duration_minutes,
        distance_km,
        distance_bucket,
        fare_amount,
        tip_amount,
        tip_percentage,
        payment_type,
        pickup_hour,
        pickup_day_of_week,
        passenger_count,
        pickup_location_id,
        dropoff_location_id
    FROM taxi_sample
    WHERE sample_group <= 3  -- Prendre seulement les 3 premiers groupes
)

SELECT * FROM representative_sample
  );
[0m09:05:27.356736 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.01 seconds
[0m09:05:27.363743 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.01 seconds
[0m09:05:27.369638 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:05:27.374605 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:05:27.376070 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
alter table "nyc_taxi_db"."public"."source_dim_weather" rename to "source_dim_weather__dbt_backup"
[0m09:05:27.377415 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
alter table "nyc_taxi_db"."public"."source_fact_taxi_trips" rename to "source_fact_taxi_trips__dbt_backup"
[0m09:05:27.379469 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:05:27.380421 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:05:27.384703 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:05:27.390452 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:05:27.391555 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
alter table "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" rename to "source_dim_weather"
[0m09:05:27.392523 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
alter table "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" rename to "source_fact_taxi_trips"
[0m09:05:27.394326 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:05:27.395771 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:05:27.438217 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m09:05:27.443344 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m09:05:27.444281 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:05:27.445441 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:05:27.446887 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m09:05:27.447847 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m09:05:27.454049 [debug] [Thread-1  ]: SQL status: COMMIT in 0.01 seconds
[0m09:05:27.454921 [debug] [Thread-2  ]: SQL status: COMMIT in 0.01 seconds
[0m09:05:27.462903 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m09:05:27.466624 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m09:05:27.467932 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
drop view if exists "nyc_taxi_db"."public"."source_dim_weather__dbt_backup" cascade
[0m09:05:27.469066 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
drop view if exists "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_backup" cascade
[0m09:05:27.472262 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m09:05:27.475191 [debug] [Thread-1  ]: finished collecting timing info
[0m09:05:27.475490 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.0 seconds
[0m09:05:27.476496 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: Close
[0m09:05:27.480798 [debug] [Thread-2  ]: finished collecting timing info
[0m09:05:27.483639 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2bc866d-b566-4509-9dd9-88c7772d9734', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6047e48d00>]}
[0m09:05:27.487687 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: Close
[0m09:05:27.489586 [info ] [Thread-1  ]: 1 of 5 OK created sql view model public.source_dim_weather ..................... [[32mCREATE VIEW[0m in 0.27s]
[0m09:05:27.491497 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2bc866d-b566-4509-9dd9-88c7772d9734', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6047e5db20>]}
[0m09:05:27.492782 [debug] [Thread-1  ]: Finished running node model.nyc_taxi.source_dim_weather
[0m09:05:27.494294 [info ] [Thread-2  ]: 2 of 5 OK created sql view model public.source_fact_taxi_trips ................. [[32mCREATE VIEW[0m in 0.27s]
[0m09:05:27.497455 [debug] [Thread-2  ]: Finished running node model.nyc_taxi.source_fact_taxi_trips
[0m09:05:27.500200 [debug] [Thread-4  ]: Began running node model.nyc_taxi.trip_enriched
[0m09:05:27.501382 [info ] [Thread-4  ]: 3 of 5 START sql table model public.trip_enriched .............................. [RUN]
[0m09:05:27.503518 [debug] [Thread-4  ]: Acquiring new postgres connection "model.nyc_taxi.trip_enriched"
[0m09:05:27.505078 [debug] [Thread-4  ]: Began compiling node model.nyc_taxi.trip_enriched
[0m09:05:27.506234 [debug] [Thread-4  ]: Compiling model.nyc_taxi.trip_enriched
[0m09:05:27.513855 [debug] [Thread-4  ]: Writing injected SQL for node "model.nyc_taxi.trip_enriched"
[0m09:05:27.524666 [debug] [Thread-4  ]: finished collecting timing info
[0m09:05:27.526032 [debug] [Thread-4  ]: Began executing node model.nyc_taxi.trip_enriched
[0m09:05:27.563158 [debug] [Thread-4  ]: Writing runtime sql for node "model.nyc_taxi.trip_enriched"
[0m09:05:27.575353 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m09:05:27.576607 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: BEGIN
[0m09:05:27.577623 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:05:27.585753 [debug] [Thread-4  ]: SQL status: BEGIN in 0.01 seconds
[0m09:05:27.587036 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m09:05:27.588018 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */

  
    

  create  table "nyc_taxi_db"."public"."trip_enriched__dbt_tmp"
  as (
    

WITH taxi_trips AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_fact_taxi_trips"
),

weather AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_dim_weather"
),

-- Créer une jointure simple basée sur l'heure et le jour
weather_simplified AS (
    SELECT 
        hour_of_day,
        day_of_week,
        AVG(temperature) as avg_temperature,
        AVG(humidity) as avg_humidity,
        AVG(wind_speed) as avg_wind_speed,
        -- Utiliser la première valeur non-null pour les catégories
        MIN(weather_condition) as weather_condition,
        MIN(weather_category) as weather_category
    FROM weather
    WHERE temperature IS NOT NULL 
      AND hour_of_day IS NOT NULL 
      AND day_of_week IS NOT NULL
    GROUP BY hour_of_day, day_of_week
)

SELECT
    t.pickup_datetime,
    t.dropoff_datetime,
    t.trip_duration_minutes,
    t.distance_km,
    t.distance_bucket,
    t.fare_amount,
    t.tip_amount,
    t.tip_percentage,
    t.payment_type,
    t.pickup_hour,
    t.pickup_day_of_week,
    t.passenger_count,
    t.pickup_location_id,
    t.dropoff_location_id,
    
    -- Données météo jointées
    w.avg_temperature as temperature,
    w.avg_humidity as humidity,
    w.avg_wind_speed as wind_speed,
    w.weather_condition,
    w.weather_category
FROM
    taxi_trips t
LEFT JOIN
    weather_simplified w
    -- Jointure simple sur heure et jour de la semaine
    ON t.pickup_hour = w.hour_of_day 
    AND t.pickup_day_of_week = w.day_of_week
  );
  
[0m09:05:27.596267 [debug] [Thread-4  ]: SQL status: SELECT 0 in 0.01 seconds
[0m09:05:27.601389 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m09:05:27.602546 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */
alter table "nyc_taxi_db"."public"."trip_enriched" rename to "trip_enriched__dbt_backup"
[0m09:05:27.604257 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:05:27.610271 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m09:05:27.611309 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */
alter table "nyc_taxi_db"."public"."trip_enriched__dbt_tmp" rename to "trip_enriched"
[0m09:05:27.612818 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:05:27.625673 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: COMMIT
[0m09:05:27.627132 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m09:05:27.628188 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: COMMIT
[0m09:05:27.630947 [debug] [Thread-4  ]: SQL status: COMMIT in 0.0 seconds
[0m09:05:27.636347 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m09:05:27.637381 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */
drop table if exists "nyc_taxi_db"."public"."trip_enriched__dbt_backup" cascade
[0m09:05:27.640443 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.0 seconds
[0m09:05:27.643184 [debug] [Thread-4  ]: finished collecting timing info
[0m09:05:27.644314 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: Close
[0m09:05:27.646140 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2bc866d-b566-4509-9dd9-88c7772d9734', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6047b67a90>]}
[0m09:05:27.647602 [info ] [Thread-4  ]: 3 of 5 OK created sql table model public.trip_enriched ......................... [[32mSELECT 0[0m in 0.14s]
[0m09:05:27.649104 [debug] [Thread-4  ]: Finished running node model.nyc_taxi.trip_enriched
[0m09:05:27.651503 [debug] [Thread-1  ]: Began running node model.nyc_taxi.high_value_customers
[0m09:05:27.651811 [debug] [Thread-2  ]: Began running node model.nyc_taxi.trip_summary_per_hour
[0m09:05:27.653042 [info ] [Thread-1  ]: 4 of 5 START sql table model public.high_value_customers ....................... [RUN]
[0m09:05:27.654738 [info ] [Thread-2  ]: 5 of 5 START sql table model public.trip_summary_per_hour ...................... [RUN]
[0m09:05:27.656720 [debug] [Thread-1  ]: Acquiring new postgres connection "model.nyc_taxi.high_value_customers"
[0m09:05:27.658326 [debug] [Thread-2  ]: Acquiring new postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m09:05:27.659047 [debug] [Thread-1  ]: Began compiling node model.nyc_taxi.high_value_customers
[0m09:05:27.660040 [debug] [Thread-2  ]: Began compiling node model.nyc_taxi.trip_summary_per_hour
[0m09:05:27.661031 [debug] [Thread-1  ]: Compiling model.nyc_taxi.high_value_customers
[0m09:05:27.662378 [debug] [Thread-2  ]: Compiling model.nyc_taxi.trip_summary_per_hour
[0m09:05:27.672104 [debug] [Thread-1  ]: Writing injected SQL for node "model.nyc_taxi.high_value_customers"
[0m09:05:27.677275 [debug] [Thread-2  ]: Writing injected SQL for node "model.nyc_taxi.trip_summary_per_hour"
[0m09:05:27.688703 [debug] [Thread-2  ]: finished collecting timing info
[0m09:05:27.691196 [debug] [Thread-2  ]: Began executing node model.nyc_taxi.trip_summary_per_hour
[0m09:05:27.691557 [debug] [Thread-1  ]: finished collecting timing info
[0m09:05:27.700267 [debug] [Thread-2  ]: Writing runtime sql for node "model.nyc_taxi.trip_summary_per_hour"
[0m09:05:27.701349 [debug] [Thread-1  ]: Began executing node model.nyc_taxi.high_value_customers
[0m09:05:27.711160 [debug] [Thread-1  ]: Writing runtime sql for node "model.nyc_taxi.high_value_customers"
[0m09:05:27.717467 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m09:05:27.719379 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: BEGIN
[0m09:05:27.720944 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m09:05:27.721263 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m09:05:27.722310 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: BEGIN
[0m09:05:27.729080 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:05:27.736150 [debug] [Thread-2  ]: SQL status: BEGIN in 0.01 seconds
[0m09:05:27.737672 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m09:05:27.737962 [debug] [Thread-1  ]: SQL status: BEGIN in 0.01 seconds
[0m09:05:27.738694 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */

  
    

  create  table "nyc_taxi_db"."public"."trip_summary_per_hour__dbt_tmp"
  as (
    

WITH trip_data AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."trip_enriched"
)

SELECT
    pickup_hour,
    weather_category,
    COUNT(*) AS num_trips,
    AVG(trip_duration_minutes) AS avg_trip_duration,
    AVG(tip_percentage) AS avg_tip_percentage,
    AVG(fare_amount) AS avg_fare_amount,
    AVG(distance_km) AS avg_distance
FROM
    trip_data
GROUP BY
    pickup_hour,
    weather_category
  );
  
[0m09:05:27.739673 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m09:05:27.741761 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.high_value_customers"} */

  
    

  create  table "nyc_taxi_db"."public"."high_value_customers__dbt_tmp"
  as (
    

WITH trip_data AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."trip_enriched"
    WHERE pickup_hour IS NOT NULL
      AND trip_duration_minutes IS NOT NULL
      AND fare_amount IS NOT NULL
)

SELECT
    pickup_hour,
    COALESCE(weather_category, 'Unknown') as weather_category,
    COUNT(*) AS num_trips,
    ROUND(AVG(trip_duration_minutes), 2) AS avg_trip_duration,
    ROUND(AVG(COALESCE(tip_percentage, 0)), 2) AS avg_tip_percentage,
    ROUND(AVG(fare_amount), 2) AS avg_fare_amount,
    ROUND(AVG(COALESCE(distance_km, 0)), 2) AS avg_distance,
    
    -- Statistiques supplémentaires
    MIN(fare_amount) as min_fare,
    MAX(fare_amount) as max_fare,
    ROUND(STDDEV(fare_amount), 2) as stddev_fare
FROM trip_data
GROUP BY pickup_hour, COALESCE(weather_category, 'Unknown')
HAVING COUNT(*) >= 1  -- Au moins 1 trip par groupe
ORDER BY pickup_hour, num_trips DESC
  );
  
[0m09:05:27.744642 [debug] [Thread-1  ]: Postgres adapter: Postgres error: function round(double precision, integer) does not exist
LINE 22:     ROUND(AVG(trip_duration_minutes), 2) AS avg_trip_duratio...
             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m09:05:27.745769 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: ROLLBACK
[0m09:05:27.746196 [debug] [Thread-2  ]: SQL status: SELECT 0 in 0.01 seconds
[0m09:05:27.747337 [debug] [Thread-1  ]: finished collecting timing info
[0m09:05:27.751469 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m09:05:27.752775 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: Close
[0m09:05:27.753938 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */
alter table "nyc_taxi_db"."public"."trip_summary_per_hour" rename to "trip_summary_per_hour__dbt_backup"
[0m09:05:27.755711 [debug] [Thread-1  ]: Database Error in model high_value_customers (models/marts/high_value_customers.sql)
  function round(double precision, integer) does not exist
  LINE 22:     ROUND(AVG(trip_duration_minutes), 2) AS avg_trip_duratio...
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/nyc_taxi/models/marts/high_value_customers.sql
[0m09:05:27.756838 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:05:27.757444 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2bc866d-b566-4509-9dd9-88c7772d9734', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6047b1da00>]}
[0m09:05:27.761713 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m09:05:27.763076 [error] [Thread-1  ]: 4 of 5 ERROR creating sql table model public.high_value_customers .............. [[31mERROR[0m in 0.10s]
[0m09:05:27.764256 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */
alter table "nyc_taxi_db"."public"."trip_summary_per_hour__dbt_tmp" rename to "trip_summary_per_hour"
[0m09:05:27.765656 [debug] [Thread-1  ]: Finished running node model.nyc_taxi.high_value_customers
[0m09:05:27.767045 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:05:27.772534 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m09:05:27.773637 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */

        CREATE INDEX IF NOT EXISTS idx_trip_summary_per_hour_pickup_datetime ON "nyc_taxi_db"."public"."trip_summary_per_hour" (pickup_datetime)
      
[0m09:05:27.775385 [debug] [Thread-2  ]: Postgres adapter: Postgres error: column "pickup_datetime" does not exist

[0m09:05:27.776303 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: ROLLBACK
[0m09:05:27.777562 [debug] [Thread-2  ]: finished collecting timing info
[0m09:05:27.778617 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: Close
[0m09:05:27.780246 [debug] [Thread-2  ]: Database Error in model trip_summary_per_hour (models/marts/trip_summary_per_hour.sql)
  column "pickup_datetime" does not exist
  compiled Code at target/run/nyc_taxi/models/marts/trip_summary_per_hour.sql
[0m09:05:27.781528 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2bc866d-b566-4509-9dd9-88c7772d9734', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6047b317c0>]}
[0m09:05:27.783054 [error] [Thread-2  ]: 5 of 5 ERROR creating sql table model public.trip_summary_per_hour ............. [[31mERROR[0m in 0.12s]
[0m09:05:27.784444 [debug] [Thread-2  ]: Finished running node model.nyc_taxi.trip_summary_per_hour
[0m09:05:27.787977 [debug] [MainThread]: Acquiring new postgres connection "master"
[0m09:05:27.789063 [debug] [MainThread]: Using postgres connection "master"
[0m09:05:27.790009 [debug] [MainThread]: On master: BEGIN
[0m09:05:27.791024 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:05:27.799161 [debug] [MainThread]: SQL status: BEGIN in 0.01 seconds
[0m09:05:27.800256 [debug] [MainThread]: On master: COMMIT
[0m09:05:27.801273 [debug] [MainThread]: Using postgres connection "master"
[0m09:05:27.802340 [debug] [MainThread]: On master: COMMIT
[0m09:05:27.804029 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m09:05:27.805037 [debug] [MainThread]: On master: Close
[0m09:05:27.806745 [info ] [MainThread]: 
[0m09:05:27.807865 [info ] [MainThread]: Finished running 2 view models, 3 table models in 0 hours 0 minutes and 0.75 seconds (0.75s).
[0m09:05:27.808987 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:05:27.810191 [debug] [MainThread]: Connection 'model.nyc_taxi.high_value_customers' was properly closed.
[0m09:05:27.811212 [debug] [MainThread]: Connection 'model.nyc_taxi.trip_summary_per_hour' was properly closed.
[0m09:05:27.812218 [debug] [MainThread]: Connection 'model.nyc_taxi.trip_enriched' was properly closed.
[0m09:05:27.831553 [info ] [MainThread]: 
[0m09:05:27.832827 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m09:05:27.834607 [info ] [MainThread]: 
[0m09:05:27.836230 [error] [MainThread]: [33mDatabase Error in model high_value_customers (models/marts/high_value_customers.sql)[0m
[0m09:05:27.838146 [error] [MainThread]:   function round(double precision, integer) does not exist
[0m09:05:27.840387 [error] [MainThread]:   LINE 22:     ROUND(AVG(trip_duration_minutes), 2) AS avg_trip_duratio...
[0m09:05:27.841928 [error] [MainThread]:                ^
[0m09:05:27.843575 [error] [MainThread]:   HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
[0m09:05:27.845190 [error] [MainThread]:   compiled Code at target/run/nyc_taxi/models/marts/high_value_customers.sql
[0m09:05:27.846683 [info ] [MainThread]: 
[0m09:05:27.848177 [error] [MainThread]: [33mDatabase Error in model trip_summary_per_hour (models/marts/trip_summary_per_hour.sql)[0m
[0m09:05:27.850335 [error] [MainThread]:   column "pickup_datetime" does not exist
[0m09:05:27.851973 [error] [MainThread]:   compiled Code at target/run/nyc_taxi/models/marts/trip_summary_per_hour.sql
[0m09:05:27.854762 [info ] [MainThread]: 
[0m09:05:27.857367 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=2 SKIP=0 TOTAL=5
[0m09:05:27.860297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6047ed7280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6047b93430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6047b9e400>]}
[0m09:05:27.862396 [debug] [MainThread]: Flushing usage events


============================== 2025-05-22 10:01:02.917209 | 8f31aca6-5ee6-4ead-a0a0-1e95fc612c59 ==============================
[0m10:01:02.917239 [info ] [MainThread]: Running with dbt=1.3.0
[0m10:01:02.919283 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/usr/app/dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m10:01:02.920671 [debug] [MainThread]: Tracking: tracking
[0m10:01:02.930443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5c1740280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5c1740370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5c1740310>]}
[0m10:01:03.170434 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:01:03.171510 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:01:03.180409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8f31aca6-5ee6-4ead-a0a0-1e95fc612c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5c12a40d0>]}
[0m10:01:03.200297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8f31aca6-5ee6-4ead-a0a0-1e95fc612c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5c1360310>]}
[0m10:01:03.201726 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 289 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m10:01:03.203354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8f31aca6-5ee6-4ead-a0a0-1e95fc612c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5c13601c0>]}
[0m10:01:03.207201 [info ] [MainThread]: 
[0m10:01:03.209519 [debug] [MainThread]: Acquiring new postgres connection "master"
[0m10:01:03.212751 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db"
[0m10:01:03.230922 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db"
[0m10:01:03.232424 [debug] [ThreadPool]: On list_nyc_taxi_db: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db"} */

    select distinct nspname from pg_namespace
  
[0m10:01:03.233545 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:01:03.255325 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.02 seconds
[0m10:01:03.257823 [debug] [ThreadPool]: On list_nyc_taxi_db: Close
[0m10:01:03.261544 [debug] [ThreadPool]: Acquiring new postgres connection "list_nyc_taxi_db_public"
[0m10:01:03.276923 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m10:01:03.277866 [debug] [ThreadPool]: On list_nyc_taxi_db_public: BEGIN
[0m10:01:03.278689 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:01:03.288465 [debug] [ThreadPool]: SQL status: BEGIN in 0.01 seconds
[0m10:01:03.289798 [debug] [ThreadPool]: Using postgres connection "list_nyc_taxi_db_public"
[0m10:01:03.290745 [debug] [ThreadPool]: On list_nyc_taxi_db_public: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "list_nyc_taxi_db_public"} */
select
      'nyc_taxi_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'nyc_taxi_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
[0m10:01:03.300600 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.01 seconds
[0m10:01:03.336422 [debug] [ThreadPool]: On list_nyc_taxi_db_public: ROLLBACK
[0m10:01:03.337686 [debug] [ThreadPool]: On list_nyc_taxi_db_public: Close
[0m10:01:03.345997 [debug] [MainThread]: Using postgres connection "master"
[0m10:01:03.347109 [debug] [MainThread]: On master: BEGIN
[0m10:01:03.347927 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:01:03.356389 [debug] [MainThread]: SQL status: BEGIN in 0.01 seconds
[0m10:01:03.357579 [debug] [MainThread]: Using postgres connection "master"
[0m10:01:03.358762 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m10:01:03.384388 [debug] [MainThread]: SQL status: SELECT 2 in 0.02 seconds
[0m10:01:03.387565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8f31aca6-5ee6-4ead-a0a0-1e95fc612c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5c0fa9ca0>]}
[0m10:01:03.389221 [debug] [MainThread]: On master: ROLLBACK
[0m10:01:03.390812 [debug] [MainThread]: Using postgres connection "master"
[0m10:01:03.392148 [debug] [MainThread]: On master: BEGIN
[0m10:01:03.394028 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m10:01:03.395260 [debug] [MainThread]: On master: COMMIT
[0m10:01:03.396377 [debug] [MainThread]: Using postgres connection "master"
[0m10:01:03.397461 [debug] [MainThread]: On master: COMMIT
[0m10:01:03.399481 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m10:01:03.400976 [debug] [MainThread]: On master: Close
[0m10:01:03.403238 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:01:03.404516 [info ] [MainThread]: 
[0m10:01:03.411820 [debug] [Thread-1  ]: Began running node model.nyc_taxi.source_dim_weather
[0m10:01:03.412064 [debug] [Thread-2  ]: Began running node model.nyc_taxi.source_fact_taxi_trips
[0m10:01:03.413920 [info ] [Thread-1  ]: 1 of 5 START sql view model public.source_dim_weather .......................... [RUN]
[0m10:01:03.415634 [info ] [Thread-2  ]: 2 of 5 START sql view model public.source_fact_taxi_trips ...................... [RUN]
[0m10:01:03.417999 [debug] [Thread-1  ]: Acquiring new postgres connection "model.nyc_taxi.source_dim_weather"
[0m10:01:03.420134 [debug] [Thread-2  ]: Acquiring new postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m10:01:03.421022 [debug] [Thread-1  ]: Began compiling node model.nyc_taxi.source_dim_weather
[0m10:01:03.422176 [debug] [Thread-2  ]: Began compiling node model.nyc_taxi.source_fact_taxi_trips
[0m10:01:03.423547 [debug] [Thread-1  ]: Compiling model.nyc_taxi.source_dim_weather
[0m10:01:03.424727 [debug] [Thread-2  ]: Compiling model.nyc_taxi.source_fact_taxi_trips
[0m10:01:03.431310 [debug] [Thread-1  ]: Writing injected SQL for node "model.nyc_taxi.source_dim_weather"
[0m10:01:03.438652 [debug] [Thread-2  ]: Writing injected SQL for node "model.nyc_taxi.source_fact_taxi_trips"
[0m10:01:03.449538 [debug] [Thread-1  ]: finished collecting timing info
[0m10:01:03.451554 [debug] [Thread-1  ]: Began executing node model.nyc_taxi.source_dim_weather
[0m10:01:03.452274 [debug] [Thread-2  ]: finished collecting timing info
[0m10:01:03.476071 [debug] [Thread-2  ]: Began executing node model.nyc_taxi.source_fact_taxi_trips
[0m10:01:03.560249 [debug] [Thread-2  ]: Writing runtime sql for node "model.nyc_taxi.source_fact_taxi_trips"
[0m10:01:03.564147 [debug] [Thread-1  ]: Writing runtime sql for node "model.nyc_taxi.source_dim_weather"
[0m10:01:03.573420 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m10:01:03.575030 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: BEGIN
[0m10:01:03.576464 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m10:01:03.576856 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m10:01:03.579519 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: BEGIN
[0m10:01:03.581099 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:01:03.589737 [debug] [Thread-1  ]: SQL status: BEGIN in 0.01 seconds
[0m10:01:03.594144 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m10:01:03.594544 [debug] [Thread-2  ]: SQL status: BEGIN in 0.01 seconds
[0m10:01:03.595473 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */

  create view "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" as (
    

SELECT
    timestamp,
    temperature,
    humidity,
    wind_speed,
    weather_condition,
    weather_description,
    weather_category,
    hour_of_day,
    day_of_week
FROM
    "nyc_taxi_db"."public"."dim_weather"
  );
[0m10:01:03.596469 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m10:01:03.598770 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */

  create view "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" as (
    

-- Échantillonnage stratifié pour conserver la représentativité
WITH taxi_sample AS (
    SELECT 
        *,
        -- Utiliser NTILE pour créer des groupes stratifiés par heure et jour
        NTILE(1000) OVER (
            PARTITION BY pickup_hour, pickup_day_of_week 
            ORDER BY pickup_datetime
        ) as sample_group
    FROM "nyc_taxi_db"."public"."fact_taxi_trips"
    WHERE 
        -- Filtrer sur une période spécifique pour réduire encore plus si nécessaire
        pickup_datetime >= '2022-01-01'
        AND pickup_datetime < '2022-04-01'  -- 3 mois au lieu de 2 ans
),

-- Prendre seulement les 3 premiers groupes de chaque strate (≈ 0.3% des données)
representative_sample AS (
    SELECT 
        pickup_datetime,
        dropoff_datetime,
        trip_duration_minutes,
        distance_km,
        distance_bucket,
        fare_amount,
        tip_amount,
        tip_percentage,
        payment_type,
        pickup_hour,
        pickup_day_of_week,
        passenger_count,
        pickup_location_id,
        dropoff_location_id
    FROM taxi_sample
    WHERE sample_group <= 3  -- Prendre seulement les 3 premiers groupes
)

SELECT * FROM representative_sample
  );
[0m10:01:03.609921 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.01 seconds
[0m10:01:03.610266 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.01 seconds
[0m10:01:03.623013 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m10:01:03.627367 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m10:01:03.629619 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
alter table "nyc_taxi_db"."public"."source_dim_weather" rename to "source_dim_weather__dbt_backup"
[0m10:01:03.630853 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
alter table "nyc_taxi_db"."public"."source_fact_taxi_trips" rename to "source_fact_taxi_trips__dbt_backup"
[0m10:01:03.634483 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:01:03.634715 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:01:03.639330 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m10:01:03.644385 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m10:01:03.645488 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
alter table "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_tmp" rename to "source_fact_taxi_trips"
[0m10:01:03.646727 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
alter table "nyc_taxi_db"."public"."source_dim_weather__dbt_tmp" rename to "source_dim_weather"
[0m10:01:03.649073 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:01:03.650406 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:01:03.698245 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m10:01:03.698765 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m10:01:03.699713 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m10:01:03.701095 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m10:01:03.702360 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: COMMIT
[0m10:01:03.703442 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: COMMIT
[0m10:01:03.707700 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m10:01:03.708583 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m10:01:03.717699 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.source_dim_weather"
[0m10:01:03.721798 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.source_fact_taxi_trips"
[0m10:01:03.723542 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_dim_weather"} */
drop view if exists "nyc_taxi_db"."public"."source_dim_weather__dbt_backup" cascade
[0m10:01:03.725095 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.source_fact_taxi_trips"} */
drop view if exists "nyc_taxi_db"."public"."source_fact_taxi_trips__dbt_backup" cascade
[0m10:01:03.731156 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m10:01:03.731936 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.0 seconds
[0m10:01:03.734462 [debug] [Thread-1  ]: finished collecting timing info
[0m10:01:03.737099 [debug] [Thread-2  ]: finished collecting timing info
[0m10:01:03.738694 [debug] [Thread-1  ]: On model.nyc_taxi.source_dim_weather: Close
[0m10:01:03.739766 [debug] [Thread-2  ]: On model.nyc_taxi.source_fact_taxi_trips: Close
[0m10:01:03.741727 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f31aca6-5ee6-4ead-a0a0-1e95fc612c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5c0fe2d90>]}
[0m10:01:03.743376 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f31aca6-5ee6-4ead-a0a0-1e95fc612c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5c0fd9ee0>]}
[0m10:01:03.744781 [info ] [Thread-1  ]: 1 of 5 OK created sql view model public.source_dim_weather ..................... [[32mCREATE VIEW[0m in 0.32s]
[0m10:01:03.746142 [info ] [Thread-2  ]: 2 of 5 OK created sql view model public.source_fact_taxi_trips ................. [[32mCREATE VIEW[0m in 0.32s]
[0m10:01:03.747677 [debug] [Thread-1  ]: Finished running node model.nyc_taxi.source_dim_weather
[0m10:01:03.749134 [debug] [Thread-2  ]: Finished running node model.nyc_taxi.source_fact_taxi_trips
[0m10:01:03.753941 [debug] [Thread-4  ]: Began running node model.nyc_taxi.trip_enriched
[0m10:01:03.755207 [info ] [Thread-4  ]: 3 of 5 START sql table model public.trip_enriched .............................. [RUN]
[0m10:01:03.756897 [debug] [Thread-4  ]: Acquiring new postgres connection "model.nyc_taxi.trip_enriched"
[0m10:01:03.757914 [debug] [Thread-4  ]: Began compiling node model.nyc_taxi.trip_enriched
[0m10:01:03.758842 [debug] [Thread-4  ]: Compiling model.nyc_taxi.trip_enriched
[0m10:01:03.765952 [debug] [Thread-4  ]: Writing injected SQL for node "model.nyc_taxi.trip_enriched"
[0m10:01:03.777220 [debug] [Thread-4  ]: finished collecting timing info
[0m10:01:03.778764 [debug] [Thread-4  ]: Began executing node model.nyc_taxi.trip_enriched
[0m10:01:03.816143 [debug] [Thread-4  ]: Writing runtime sql for node "model.nyc_taxi.trip_enriched"
[0m10:01:03.826857 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m10:01:03.827914 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: BEGIN
[0m10:01:03.829062 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:01:03.836883 [debug] [Thread-4  ]: SQL status: BEGIN in 0.01 seconds
[0m10:01:03.837976 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m10:01:03.838923 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */

  
    

  create  table "nyc_taxi_db"."public"."trip_enriched__dbt_tmp"
  as (
    

WITH taxi_trips AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_fact_taxi_trips"
),

weather AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."source_dim_weather"
),

-- Créer une jointure simple basée sur l'heure et le jour
weather_simplified AS (
    SELECT 
        hour_of_day,
        day_of_week,
        AVG(temperature) as avg_temperature,
        AVG(humidity) as avg_humidity,
        AVG(wind_speed) as avg_wind_speed,
        -- Utiliser la première valeur non-null pour les catégories
        MIN(weather_condition) as weather_condition,
        MIN(weather_category) as weather_category
    FROM weather
    WHERE temperature IS NOT NULL 
      AND hour_of_day IS NOT NULL 
      AND day_of_week IS NOT NULL
    GROUP BY hour_of_day, day_of_week
)

SELECT
    t.pickup_datetime,
    t.dropoff_datetime,
    t.trip_duration_minutes,
    t.distance_km,
    t.distance_bucket,
    t.fare_amount,
    t.tip_amount,
    t.tip_percentage,
    t.payment_type,
    t.pickup_hour,
    t.pickup_day_of_week,
    t.passenger_count,
    t.pickup_location_id,
    t.dropoff_location_id,
    
    -- Données météo jointées
    w.avg_temperature as temperature,
    w.avg_humidity as humidity,
    w.avg_wind_speed as wind_speed,
    w.weather_condition,
    w.weather_category
FROM
    taxi_trips t
LEFT JOIN
    weather_simplified w
    -- Jointure simple sur heure et jour de la semaine
    ON t.pickup_hour = w.hour_of_day 
    AND t.pickup_day_of_week = w.day_of_week
  );
  
[0m10:01:03.851486 [debug] [Thread-4  ]: SQL status: SELECT 0 in 0.01 seconds
[0m10:01:03.858279 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m10:01:03.859521 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */
alter table "nyc_taxi_db"."public"."trip_enriched" rename to "trip_enriched__dbt_backup"
[0m10:01:03.861452 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:01:03.865902 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m10:01:03.867011 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */
alter table "nyc_taxi_db"."public"."trip_enriched__dbt_tmp" rename to "trip_enriched"
[0m10:01:03.868604 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:01:03.878546 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: COMMIT
[0m10:01:03.879952 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m10:01:03.881254 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: COMMIT
[0m10:01:03.884210 [debug] [Thread-4  ]: SQL status: COMMIT in 0.0 seconds
[0m10:01:03.888107 [debug] [Thread-4  ]: Using postgres connection "model.nyc_taxi.trip_enriched"
[0m10:01:03.889805 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_enriched"} */
drop table if exists "nyc_taxi_db"."public"."trip_enriched__dbt_backup" cascade
[0m10:01:03.896132 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.0 seconds
[0m10:01:03.899765 [debug] [Thread-4  ]: finished collecting timing info
[0m10:01:03.901576 [debug] [Thread-4  ]: On model.nyc_taxi.trip_enriched: Close
[0m10:01:03.905511 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f31aca6-5ee6-4ead-a0a0-1e95fc612c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5c0f2db80>]}
[0m10:01:03.907613 [info ] [Thread-4  ]: 3 of 5 OK created sql table model public.trip_enriched ......................... [[32mSELECT 0[0m in 0.15s]
[0m10:01:03.909527 [debug] [Thread-4  ]: Finished running node model.nyc_taxi.trip_enriched
[0m10:01:03.912674 [debug] [Thread-1  ]: Began running node model.nyc_taxi.high_value_customers
[0m10:01:03.913031 [debug] [Thread-2  ]: Began running node model.nyc_taxi.trip_summary_per_hour
[0m10:01:03.914182 [info ] [Thread-1  ]: 4 of 5 START sql table model public.high_value_customers ....................... [RUN]
[0m10:01:03.915693 [info ] [Thread-2  ]: 5 of 5 START sql table model public.trip_summary_per_hour ...................... [RUN]
[0m10:01:03.918169 [debug] [Thread-1  ]: Acquiring new postgres connection "model.nyc_taxi.high_value_customers"
[0m10:01:03.921552 [debug] [Thread-2  ]: Acquiring new postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m10:01:03.923366 [debug] [Thread-1  ]: Began compiling node model.nyc_taxi.high_value_customers
[0m10:01:03.924696 [debug] [Thread-2  ]: Began compiling node model.nyc_taxi.trip_summary_per_hour
[0m10:01:03.926190 [debug] [Thread-1  ]: Compiling model.nyc_taxi.high_value_customers
[0m10:01:03.927447 [debug] [Thread-2  ]: Compiling model.nyc_taxi.trip_summary_per_hour
[0m10:01:03.935372 [debug] [Thread-1  ]: Writing injected SQL for node "model.nyc_taxi.high_value_customers"
[0m10:01:03.943382 [debug] [Thread-2  ]: Writing injected SQL for node "model.nyc_taxi.trip_summary_per_hour"
[0m10:01:03.950337 [debug] [Thread-1  ]: finished collecting timing info
[0m10:01:03.952510 [debug] [Thread-1  ]: Began executing node model.nyc_taxi.high_value_customers
[0m10:01:03.953842 [debug] [Thread-2  ]: finished collecting timing info
[0m10:01:03.962052 [debug] [Thread-1  ]: Writing runtime sql for node "model.nyc_taxi.high_value_customers"
[0m10:01:03.962933 [debug] [Thread-2  ]: Began executing node model.nyc_taxi.trip_summary_per_hour
[0m10:01:03.973575 [debug] [Thread-2  ]: Writing runtime sql for node "model.nyc_taxi.trip_summary_per_hour"
[0m10:01:03.979109 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m10:01:03.980884 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: BEGIN
[0m10:01:03.982285 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m10:01:03.982895 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m10:01:03.985766 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: BEGIN
[0m10:01:03.986959 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m10:01:03.994235 [debug] [Thread-1  ]: SQL status: BEGIN in 0.01 seconds
[0m10:01:03.995545 [debug] [Thread-1  ]: Using postgres connection "model.nyc_taxi.high_value_customers"
[0m10:01:03.996617 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.high_value_customers"} */

  
    

  create  table "nyc_taxi_db"."public"."high_value_customers__dbt_tmp"
  as (
    

WITH trip_data AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."trip_enriched"
    WHERE pickup_hour IS NOT NULL
      AND trip_duration_minutes IS NOT NULL
      AND fare_amount IS NOT NULL
)

SELECT
    pickup_hour,
    COALESCE(weather_category, 'Unknown') as weather_category,
    COUNT(*) AS num_trips,
    ROUND(AVG(trip_duration_minutes), 2) AS avg_trip_duration,
    ROUND(AVG(COALESCE(tip_percentage, 0)), 2) AS avg_tip_percentage,
    ROUND(AVG(fare_amount), 2) AS avg_fare_amount,
    ROUND(AVG(COALESCE(distance_km, 0)), 2) AS avg_distance,
    
    -- Statistiques supplémentaires
    MIN(fare_amount) as min_fare,
    MAX(fare_amount) as max_fare,
    ROUND(STDDEV(fare_amount), 2) as stddev_fare
FROM trip_data
GROUP BY pickup_hour, COALESCE(weather_category, 'Unknown')
HAVING COUNT(*) >= 1  -- Au moins 1 trip par groupe
ORDER BY pickup_hour, num_trips DESC
  );
  
[0m10:01:03.997752 [debug] [Thread-2  ]: SQL status: BEGIN in 0.01 seconds
[0m10:01:03.998831 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m10:01:03.999842 [debug] [Thread-1  ]: Postgres adapter: Postgres error: function round(double precision, integer) does not exist
LINE 22:     ROUND(AVG(trip_duration_minutes), 2) AS avg_trip_duratio...
             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m10:01:04.000284 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */

  
    

  create  table "nyc_taxi_db"."public"."trip_summary_per_hour__dbt_tmp"
  as (
    

WITH trip_data AS (
    SELECT *
    FROM "nyc_taxi_db"."public"."trip_enriched"
)

SELECT
    pickup_hour,
    weather_category,
    COUNT(*) AS num_trips,
    AVG(trip_duration_minutes) AS avg_trip_duration,
    AVG(tip_percentage) AS avg_tip_percentage,
    AVG(fare_amount) AS avg_fare_amount,
    AVG(distance_km) AS avg_distance
FROM
    trip_data
GROUP BY
    pickup_hour,
    weather_category
  );
  
[0m10:01:04.001298 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: ROLLBACK
[0m10:01:04.003608 [debug] [Thread-1  ]: finished collecting timing info
[0m10:01:04.004961 [debug] [Thread-1  ]: On model.nyc_taxi.high_value_customers: Close
[0m10:01:04.006713 [debug] [Thread-1  ]: Database Error in model high_value_customers (models/marts/high_value_customers.sql)
  function round(double precision, integer) does not exist
  LINE 22:     ROUND(AVG(trip_duration_minutes), 2) AS avg_trip_duratio...
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/nyc_taxi/models/marts/high_value_customers.sql
[0m10:01:04.008105 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f31aca6-5ee6-4ead-a0a0-1e95fc612c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5c1262c70>]}
[0m10:01:04.009689 [error] [Thread-1  ]: 4 of 5 ERROR creating sql table model public.high_value_customers .............. [[31mERROR[0m in 0.09s]
[0m10:01:04.011230 [debug] [Thread-1  ]: Finished running node model.nyc_taxi.high_value_customers
[0m10:01:04.011514 [debug] [Thread-2  ]: SQL status: SELECT 0 in 0.01 seconds
[0m10:01:04.017340 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m10:01:04.018622 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */
alter table "nyc_taxi_db"."public"."trip_summary_per_hour" rename to "trip_summary_per_hour__dbt_backup"
[0m10:01:04.020311 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:01:04.025848 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m10:01:04.027040 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */
alter table "nyc_taxi_db"."public"."trip_summary_per_hour__dbt_tmp" rename to "trip_summary_per_hour"
[0m10:01:04.028469 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:01:04.034353 [debug] [Thread-2  ]: Using postgres connection "model.nyc_taxi.trip_summary_per_hour"
[0m10:01:04.035616 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: /* {"app": "dbt", "dbt_version": "1.3.0", "profile_name": "nyc_taxi", "target_name": "dev", "node_id": "model.nyc_taxi.trip_summary_per_hour"} */

        CREATE INDEX IF NOT EXISTS idx_trip_summary_per_hour_pickup_datetime ON "nyc_taxi_db"."public"."trip_summary_per_hour" (pickup_datetime)
      
[0m10:01:04.038476 [debug] [Thread-2  ]: Postgres adapter: Postgres error: column "pickup_datetime" does not exist

[0m10:01:04.039511 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: ROLLBACK
[0m10:01:04.040836 [debug] [Thread-2  ]: finished collecting timing info
[0m10:01:04.041671 [debug] [Thread-2  ]: On model.nyc_taxi.trip_summary_per_hour: Close
[0m10:01:04.043372 [debug] [Thread-2  ]: Database Error in model trip_summary_per_hour (models/marts/trip_summary_per_hour.sql)
  column "pickup_datetime" does not exist
  compiled Code at target/run/nyc_taxi/models/marts/trip_summary_per_hour.sql
[0m10:01:04.044704 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f31aca6-5ee6-4ead-a0a0-1e95fc612c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5c0f7a5b0>]}
[0m10:01:04.046034 [error] [Thread-2  ]: 5 of 5 ERROR creating sql table model public.trip_summary_per_hour ............. [[31mERROR[0m in 0.12s]
[0m10:01:04.047228 [debug] [Thread-2  ]: Finished running node model.nyc_taxi.trip_summary_per_hour
[0m10:01:04.050772 [debug] [MainThread]: Acquiring new postgres connection "master"
[0m10:01:04.051988 [debug] [MainThread]: Using postgres connection "master"
[0m10:01:04.052997 [debug] [MainThread]: On master: BEGIN
[0m10:01:04.053969 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:01:04.061436 [debug] [MainThread]: SQL status: BEGIN in 0.01 seconds
[0m10:01:04.062491 [debug] [MainThread]: On master: COMMIT
[0m10:01:04.063410 [debug] [MainThread]: Using postgres connection "master"
[0m10:01:04.064530 [debug] [MainThread]: On master: COMMIT
[0m10:01:04.066160 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m10:01:04.067099 [debug] [MainThread]: On master: Close
[0m10:01:04.068762 [info ] [MainThread]: 
[0m10:01:04.069915 [info ] [MainThread]: Finished running 2 view models, 3 table models in 0 hours 0 minutes and 0.86 seconds (0.86s).
[0m10:01:04.071335 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:01:04.072434 [debug] [MainThread]: Connection 'model.nyc_taxi.high_value_customers' was properly closed.
[0m10:01:04.073434 [debug] [MainThread]: Connection 'model.nyc_taxi.trip_summary_per_hour' was properly closed.
[0m10:01:04.074368 [debug] [MainThread]: Connection 'model.nyc_taxi.trip_enriched' was properly closed.
[0m10:01:04.094681 [info ] [MainThread]: 
[0m10:01:04.096089 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m10:01:04.097616 [info ] [MainThread]: 
[0m10:01:04.099326 [error] [MainThread]: [33mDatabase Error in model high_value_customers (models/marts/high_value_customers.sql)[0m
[0m10:01:04.100823 [error] [MainThread]:   function round(double precision, integer) does not exist
[0m10:01:04.102075 [error] [MainThread]:   LINE 22:     ROUND(AVG(trip_duration_minutes), 2) AS avg_trip_duratio...
[0m10:01:04.103300 [error] [MainThread]:                ^
[0m10:01:04.104451 [error] [MainThread]:   HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
[0m10:01:04.105555 [error] [MainThread]:   compiled Code at target/run/nyc_taxi/models/marts/high_value_customers.sql
[0m10:01:04.106775 [info ] [MainThread]: 
[0m10:01:04.107901 [error] [MainThread]: [33mDatabase Error in model trip_summary_per_hour (models/marts/trip_summary_per_hour.sql)[0m
[0m10:01:04.109090 [error] [MainThread]:   column "pickup_datetime" does not exist
[0m10:01:04.110269 [error] [MainThread]:   compiled Code at target/run/nyc_taxi/models/marts/trip_summary_per_hour.sql
[0m10:01:04.111635 [info ] [MainThread]: 
[0m10:01:04.112776 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=2 SKIP=0 TOTAL=5
[0m10:01:04.114156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5c1360190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5c0ee8dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5c0ee8d30>]}
[0m10:01:04.115476 [debug] [MainThread]: Flushing usage events
